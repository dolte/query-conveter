<mapper namespace="kr.or.komca.center..mapper.Mapper">
<select id="SQLmon_collect_list_SEL3" parameterType="" resultType="">
SELECT
	(
		CASE
			WHEN # { fromYrmn } >= '201006'
			AND # { fromYrmn } < '201206' THEN '1'
			WHEN # { fromYrmn } >= '201206' THEN '2'
			ELSE '3'
		END
	) AS YRMN
FROM
	DUAL
</select>

<select id="SQLmon_collect_list_SEL7" parameterType="" resultType="">
SELECT
	BSTYP_NM,
	MNG_CNT,
	TOT_AMT,
	COL_UPSO,
	COL_AMT,
	MAP_UPSO,
	MAP_AMT
FROM
(
		SELECT
			NVL(TB.GRADNM, '???') BSTYP_NM,
			SUM(MNG_CNT) MNG_CNT,
			SUM(TOT_AMT) TOT_AMT,
			SUM(COL_UPSO) COL_UPSO,
			SUM(COL_AMT - RETURN_AMT) COL_AMT,
			SUM(MAP_UPSO) MAP_UPSO,
			SUM(MAP_AMT) MAP_AMT,
			SUM(RETURN_AMT) RETURN_AMT
		FROM
(
				SELECT
					TB.BSTYP_CD,
					COUNT(*) MNG_CNT,
					SUM(TB.MONPRNCFEE) TOT_AMT,
					0 COL_UPSO,
					0 COL_AMT,
					0 MAP_UPSO,
					0 MAP_AMT,
					0 RETURN_AMT
				FROM
					GIBU.TBRA_UPSO TA,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) TB
				WHERE
					TA.BRAN_CD = DECODE(# { branCd }, 'AL', TA.BRAN_CD, # { branCd })
					AND TA.NEW_DAY IS NOT NULL
					AND TA.NEW_DAY <= # { toYrmn } || '31'
					AND (
						TA.CLSBS_YRMN IS NULL
						OR NVL(SUBSTR(TA.CLSBS_INS_DAY, 1, 6), '  ') > # { toYrmn }
					)
					AND TB.UPSO_CD = TA.UPSO_CD
				GROUP BY
					TB.BSTYP_CD
				UNION ALL
				SELECT
					CC.BSTYP_CD,
					0 MNG_CNT,
					0 TOT_AMT,
					COUNT(DISTINCT AA.UPSO_CD),
					SUM(NVL(AA.REPT_AMT, 0) - NVL(AA.COMIS, 0)),
					0 MAP_UPSO,
					0 MAP_AMT,
					0 RETURN_AMT
				FROM
					(
						SELECT
							REPT_DAY,
							REPT_NUM,
							REPT_AMT,
							COMIS,
							UPSO_CD
						FROM
							GIBU.TBRA_REPT
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND DISTR_GBN IS NULL
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
						UNION ALL
						SELECT
							REPT_DAY,
							REPT_NUM,
							DISTR_AMT,
							0,
							UPSO_CD
						FROM
							GIBU.TBRA_REPT_UPSO_DISTR
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					) AA,
					GIBU.TBRA_UPSO BB,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) CC
				WHERE
					AA.UPSO_CD IS NOT NULL
					AND BB.NEW_DAY IS NOT NULL
					AND BB.NEW_DAY <= # { toYrmn } || '31'
					AND BB.UPSO_CD = AA.UPSO_CD
					AND CC.UPSO_CD = AA.UPSO_CD
				GROUP BY
					CC.BSTYP_CD
				UNION ALL
				SELECT
					CC.BSTYP_CD,
					0,
					0,
					0,
					0,
					0,
					0,
					SUM(RETURN_AMT) RETURN_AMT
				FROM
					GIBU.TBRA_REPT_RETURN A,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) CC
				WHERE
					A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
					AND A.RETURN_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND A.UPSO_CD = CC.UPSO_CD
				GROUP BY
					CC.BSTYP_CD
				UNION ALL
				SELECT
					CC.BSTYP_CD,
					0,
					0,
					0,
					0,
					COUNT(DISTINCT AA.UPSO_CD),
					SUM(NVL(AA.REPT_AMT, 0) - NVL(AA.COMIS, 0)),
					0
				FROM
					(
						SELECT
							REPT_DAY,
							REPT_NUM,
							REPT_AMT,
							COMIS,
							UPSO_CD
						FROM
							GIBU.TBRA_REPT
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND DISTR_GBN IS NULL
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
							AND SUBSTR(REPT_DAY, 1, 6) <> SUBSTR(MAPPING_DAY, 1, 6)
						UNION ALL
						SELECT
							REPT_DAY,
							REPT_NUM,
							DISTR_AMT,
							0,
							UPSO_CD
						FROM
							GIBU.TBRA_REPT_UPSO_DISTR
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
							AND SUBSTR(REPT_DAY, 1, 6) <> SUBSTR(MAPPING_DAY, 1, 6)
					) AA,
					GIBU.TBRA_UPSO BB,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) CC
				WHERE
					AA.UPSO_CD IS NOT NULL
					AND BB.NEW_DAY IS NOT NULL
					AND BB.NEW_DAY <= # { toYrmn } || '31'
					AND BB.UPSO_CD = AA.UPSO_CD
					AND CC.UPSO_CD = AA.UPSO_CD
				GROUP BY
					CC.BSTYP_CD
				UNION ALL
				SELECT
					'v' BSTYP_CD,
					SUM(CNT) MNG_CNT,
					SUM(AMT) MNG_AMT,
					SUM(CNT) COL_CNT,
					SUM(AMT) COL_AMT,
					0 MAP_UPSO,
					0 MAP_AMT,
					0
				FROM
(
						SELECT
							COUNT(A.DEMD_NUM) CNT,
							SUM(NVL(A.REPT_AMT, 0) - NVL(A.ATAX_AMT, 0)) AMT
						FROM
							FIDU.TLEV_USEDEMDREPT A
						WHERE
							A.REPT_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
							AND A.MDM_CD LIKE 'DA%'
							AND DECODE(# { reptGbn }, NULL, '03', '03', '03', 'X') = '03'
					)
			) TA,
			GIBU.TBRA_BSTYPGRAD TB
		WHERE
			TB.BSTYP_CD(+) = 'z'
			AND TB.GRAD_GBN(+) = TA.BSTYP_CD
		GROUP BY
			NVL(TB.GRADNM, '???')
	)
WHERE
	MNG_CNT IS NOT NULL
	AND COL_UPSO IS NOT NULL
ORDER BY
	MNG_CNT DESC
</select>

<select id="SQLmon_collect_list_SEL8" parameterType="" resultType="">
SELECT
	BSTYP_NM,
	SUM(COUNT2) COL_UPSO,
	SUM(AMT2) COL_AMT,
	0 MAP_UPSO,
	0 MAP_AMT
FROM
	(
		SELECT
			CC.CODE_NM BSTYP_NM,
			COUNT(DISTINCT AA.UPSO_CD) COUNT2,
			SUM(NVL(AA.REPT_AMT, 0)) - SUM(NVL(AA.COMIS, 0)) AMT2
		FROM
			(
				SELECT
					REPT_AMT,
					COMIS,
					UPSO_CD,
					REPT_GBN
				FROM
					GIBU.TBRA_REPT
				WHERE
					MAPPING_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
					AND DISTR_GBN IS NULL
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
				UNION ALL
				SELECT
					DISTR_AMT,
					0,
					UPSO_CD,
					REPT_GBN
				FROM
					GIBU.TBRA_REPT_UPSO_DISTR
				WHERE
					MAPPING_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
			) AA,
			GIBU.TBRA_UPSO BB,
			FIDU.TENV_CODE CC
		WHERE
			AA.UPSO_CD IS NOT NULL
			AND BB.NEW_DAY IS NOT NULL
			AND BB.NEW_DAY <= # { toYrmn } || '31'
			AND BB.UPSO_CD = AA.UPSO_CD
			AND CC.HIGH_CD = '00141'
			AND CC.CODE_ETC = 'A'
			AND CC.CODE_CD = AA.REPT_GBN
		GROUP BY
			CC.CODE_NM,
			AA.REPT_GBN
		UNION ALL
		SELECT
			AA.CODE_NM BSTYP_NM,
			COUNT2,
			AMT2
		FROM
			FIDU.TENV_CODE AA,
			(
				SELECT
					'03' REPT_GBN,
					COUNT(A.DEMD_NUM) COUNT2,
					SUM(NVL(A.REPT_AMT, 0) - NVL(A.ATAX_AMT, 0)) AMT2
				FROM
					FIDU.TLEV_USEDEMDREPT A
				WHERE
					A.REPT_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
					AND A.MDM_CD LIKE 'DA%'
					AND DECODE(# { reptGbn }, NULL, '03', '03', '03', 'X') = '03'
				GROUP BY
					'03'
			) BB
		WHERE
			AA.HIGH_CD = '00141'
			AND AA.CODE_ETC = 'A'
			AND BB.REPT_GBN = AA.CODE_CD
		UNION ALL
		SELECT
			'????????' BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) COUNT2,
			- SUM(RETURN_AMT) AMT2
		FROM
			GIBU.TBRA_REPT_RETURN A
		WHERE
			A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
			AND A.RETURN_DAY BETWEEN # { fromYrmn } || '01'
			AND # { toYrmn } || '31'
		UNION ALL
		--???????  ???????  ???  ?????????  ???  ????,  ??????????????????  ???????
		SELECT
			'??????' BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) COUNT2,
			SUM(RETURN_AMT) AMT2
		FROM
			GIBU.TBRA_REPT_RETURN A
		WHERE
			A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
			AND A.RETURN_DAY BETWEEN # { fromYrmn } || '01'
			AND # { toYrmn } || '31'
			AND A.UPSO_CD IS NULL
	)
WHERE
	AMT2 <> 0
GROUP BY
	BSTYP_NM
ORDER BY
	1
</select>

<select id="SQLmon_collect_list_SEL12" parameterType="" resultType="">
SELECT
	/*+  optimizer_features_enable('11.1.0.6')  */
	BSTYP_NM,
	MNG_CNT,
	TOT_AMT,
	COL_UPSO,
	COL_AMT,
	MAP_UPSO,
	MAP_AMT,
	COL_AMT - (KOSCAP_AMT + FKMP_AMT + RIAK_AMT) AS KOMCA_AMT,
	MAP_AMT - (KOSCAP_MAP + FKMP_MAP + RIAK_MAP) AS KOMCA_MAP,
	KOSCAP_AMT,
	KOSCAP_MAP,
	FKMP_AMT,
	FKMP_MAP,
	RIAK_AMT,
	RIAK_MAP,
	STOMU_AMT
FROM
	(
		SELECT
			NVL(TB.GRADNM, '???') AS BSTYP_NM,
			NVL(TB.STNDAREA_START, 99) AS ORDER_SEQ1,
			NVL(TB.MDM_CD, 'Z') AS ORDER_SEQ2,
			NVL(SUM(MNG_CNT), 0) AS MNG_CNT,
			NVL(SUM(TOT_AMT), 0) AS TOT_AMT,
			NVL(SUM(COL_UPSO), 0) AS COL_UPSO,
			NVL(SUM(COL_AMT - RETURN_AMT), 0) AS COL_AMT,
			NVL(SUM(MAP_UPSO), 0) AS MAP_UPSO,
			NVL(SUM(MAP_AMT), 0) AS MAP_AMT,
			NVL(SUM(RETURN_AMT), 0) AS RETURN_AMT,
			NVL(SUM(KOSCAP_AMT - KOSCAP_RETURN), 0) AS KOSCAP_AMT,
			NVL(SUM(KOSCAP_MAP), 0) AS KOSCAP_MAP,
			NVL(SUM(FKMP_AMT - FKMP_RETURN), 0) AS FKMP_AMT,
			NVL(SUM(FKMP_MAP), 0) AS FKMP_MAP,
			NVL(SUM(RIAK_AMT - RIAK_RETURN), 0) AS RIAK_AMT,
			NVL(SUM(RIAK_MAP), 0) AS RIAK_MAP,
			NVL(SUM(STOMU_AMT), 0) AS STOMU_AMT
		FROM
			(
				SELECT
					TB.BSTYP_CD,
					COUNT(*) AS MNG_CNT,
					SUM(TB.MONPRNCFEE) AS TOT_AMT,
					0 AS COL_UPSO,
					0 AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					GIBU.TBRA_UPSO TA,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
							(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) TB
				WHERE
					TA.BRAN_CD = DECODE(# { branCd }, 'AL', TA.BRAN_CD, # { branCd })
					AND TA.NEW_DAY IS NOT NULL
					AND TA.NEW_DAY <= # { toYrmn } || '31'
					AND (
						TA.CLSBS_YRMN IS NULL
						OR NVL(SUBSTR(TA.CLSBS_INS_DAY, 1, 6), '  ') > # { toYrmn }
					)
					AND TB.UPSO_CD = TA.UPSO_CD
					AND TB.BSTYP_CD <> 't'
				GROUP BY
					TB.BSTYP_CD
				UNION ALL
				SELECT
					CC.BSTYP_CD,
					0 AS MNG_CNT,
					0 AS TOT_AMT,
					COUNT(DISTINCT AA.UPSO_CD) AS COL_UPSO,
					SUM(NVL(AA.REPT_AMT, 0) - NVL(AA.COMIS, 0)) AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					(
						SELECT
							REPT_DAY,
							REPT_NUM,
							REPT_AMT,
							COMIS,
							UPSO_CD,
							BRAN_CD
						FROM
							GIBU.TBRA_REPT
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
							AND DISTR_GBN IS NULL
						UNION ALL
						SELECT
							REPT_DAY,
							REPT_NUM,
							DISTR_AMT,
							0,
							UPSO_CD,
							BRAN_CD
						FROM
							GIBU.TBRA_REPT_UPSO_DISTR
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
							AND REPT_GBN <> '08'
						UNION ALL
						SELECT
							A.REPT_DAY,
							A.REPT_NUM,
							(
								CASE
									WHEN MIN(DISTR_SEQ) OVER(PARTITION BY A.REPT_DAY, A.REPT_NUM, A.REPT_GBN) = DISTR_SEQ THEN A.DISTR_AMT - NVL(C.COMIS, 0)
									ELSE A.DISTR_AMT
								END
							) AS REPT_AMT,
							0,
							A.UPSO_CD,
							A.BRAN_CD
						FROM
							GIBU.TBRA_REPT_UPSO_DISTR A,
							GIBU.TBRA_REPT_VIRTUAL B,
							GIBU.TBRA_REPT C
						WHERE
							A.MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND A.REPT_DAY = B.REPT_DAY
							AND A.REPT_NUM = B.REPT_NUM
							AND A.REPT_GBN = '08'
							AND A.REPT_DAY = C.REPT_DAY(+)
							AND A.REPT_NUM = C.REPT_NUM(+)
							AND C.REPT_GBN(+) = '08'
					) AA,
					GIBU.TBRA_UPSO BB,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
							(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) CC
				WHERE
					AA.UPSO_CD IS NOT NULL
					AND AA.BRAN_CD = DECODE(# { branCd }, 'AL', AA.BRAN_CD, # { branCd })
					AND BB.NEW_DAY IS NOT NULL
					AND BB.NEW_DAY <= # { toYrmn } || '31'
					AND BB.UPSO_CD = AA.UPSO_CD
					AND CC.UPSO_CD = AA.UPSO_CD
					AND CC.BSTYP_CD <> 't'
				GROUP BY
					CC.BSTYP_CD
				UNION ALL
				SELECT
					CC.BSTYP_CD,
					0,
					0,
					0,
					0,
					0,
					0,
					SUM(RETURN_AMT) RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					GIBU.TBRA_REPT_RETURN A,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
							(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) CC
				WHERE
					A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
					AND A.RETURN_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND A.UPSO_CD = CC.UPSO_CD
					AND CC.BSTYP_CD <> 't'
				GROUP BY
					CC.BSTYP_CD
				UNION ALL
				SELECT
					CC.BSTYP_CD,
					0,
					0,
					0,
					0,
					COUNT(DISTINCT AA.UPSO_CD) AS MAP_UPSO,
					SUM(NVL(AA.REPT_AMT, 0) - NVL(AA.COMIS, 0)) AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					(
						SELECT
							REPT_DAY,
							REPT_NUM,
							REPT_AMT,
							COMIS,
							UPSO_CD
						FROM
							GIBU.TBRA_REPT
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = '03'
							AND DISTR_GBN IS NULL
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
							AND SUBSTR(REPT_DAY, 1, 6) < SUBSTR(MAPPING_DAY, 1, 6)
						UNION ALL
						SELECT
							REPT_DAY,
							REPT_NUM,
							DISTR_AMT,
							0,
							UPSO_CD
						FROM
							GIBU.TBRA_REPT_UPSO_DISTR
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = '03'
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
							AND SUBSTR(REPT_DAY, 1, 6) < SUBSTR(MAPPING_DAY, 1, 6)
					) AA,
					GIBU.TBRA_UPSO BB,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
							(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) AS JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) CC
				WHERE
					AA.UPSO_CD IS NOT NULL
					AND BB.NEW_DAY IS NOT NULL
					AND BB.NEW_DAY <= # { toYrmn } || '31'
					AND BB.UPSO_CD = AA.UPSO_CD
					AND CC.UPSO_CD = AA.UPSO_CD
					AND CC.BSTYP_CD <> 't'
				GROUP BY
					CC.BSTYP_CD
				UNION ALL
				SELECT
					't' AS BSTYP_CD,
					SUM(CNT) AS MNG_CNT,
					SUM(AMT) AS MNG_AMT,
					SUM(CNT) AS COL_CNT,
					SUM(AMT) AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					(
						SELECT
							COUNT(A.DEMD_NUM) AS CNT,
							SUM(NVL(A.REPT_AMT, 0) - NVL(A.ATAX_AMT, 0)) AS AMT
						FROM
							FIDU.TLEV_USEDEMDREPT A
						WHERE
							A.REPT_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
							AND A.MDM_CD LIKE 'CC04%'
							AND DECODE(# { reptGbn }, NULL, '03', '03', '03', 'X') = '03'
					)
				UNION ALL
				SELECT
					BSTYP_CD,
					0 AS MNG_CNT,
					0 AS MNG_AMT,
					0 AS COL_CNT,
					0 AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					SUM(PROC_AMT) AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					GIBU.TBRA_DEMD_REPT_BSCON
				WHERE
					MAPPING_YRMN BETWEEN # { fromYrmn }
					AND # { toYrmn }
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND BSCON_CD = 'T0000001'
				GROUP BY
					BSTYP_CD
				UNION ALL
				SELECT
					BSTYP_CD,
					0 AS MNG_CNT,
					0 AS MNG_AMT,
					0 AS COL_CNT,
					0 AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					SUM(PROC_AMT) AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					GIBU.TBRA_DEMD_REPT_BSCON
				WHERE
					MAPPING_YRMN BETWEEN # { fromYrmn }
					AND # { toYrmn }
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND MAPPING_YRMN > REPT_YRMN
					AND BSCON_CD = 'T0000001'
					AND REPT_GBN = '03'
				GROUP BY
					BSTYP_CD
				UNION ALL
				SELECT
					BSTYP_CD,
					0 AS MNG_CNT,
					0 AS MNG_AMT,
					0 AS COL_CNT,
					0 AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					SUM(PROC_AMT) AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					GIBU.TBRA_BSCON_RETURN
				WHERE
					RETURN_YRMN BETWEEN # { fromYrmn }
					AND # { toYrmn }
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND BSCON_CD = 'T0000001'
				GROUP BY
					BSTYP_CD
				UNION ALL
				SELECT
					BSTYP_CD,
					0 AS MNG_CNT,
					0 AS MNG_AMT,
					0 AS COL_CNT,
					0 AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					SUM(PROC_AMT) AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					GIBU.TBRA_DEMD_REPT_BSCON
				WHERE
					MAPPING_YRMN BETWEEN # { fromYrmn }
					AND # { toYrmn }
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND BSCON_CD = 'T0000002'
				GROUP BY
					BSTYP_CD
				UNION ALL
				SELECT
					BSTYP_CD,
					0 AS MNG_CNT,
					0 AS MNG_AMT,
					0 AS COL_CNT,
					0 AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					SUM(PROC_AMT) AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					GIBU.TBRA_DEMD_REPT_BSCON
				WHERE
					MAPPING_YRMN BETWEEN # { fromYrmn }
					AND # { toYrmn }
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND MAPPING_YRMN > REPT_YRMN
					AND BSCON_CD = 'T0000002'
					AND REPT_GBN = '03'
				GROUP BY
					BSTYP_CD
				UNION ALL
				SELECT
					BSTYP_CD,
					0 AS MNG_CNT,
					0 AS MNG_AMT,
					0 AS COL_CNT,
					0 AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					SUM(PROC_AMT) AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					GIBU.TBRA_BSCON_RETURN
				WHERE
					RETURN_YRMN BETWEEN # { fromYrmn }
					AND # { toYrmn }
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND BSCON_CD = 'T0000002'
				GROUP BY
					BSTYP_CD
				UNION ALL
				SELECT
					BSTYP_CD,
					0 AS MNG_CNT,
					0 AS MNG_AMT,
					0 AS COL_CNT,
					0 AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					SUM(PROC_AMT) AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					GIBU.TBRA_DEMD_REPT_BSCON
				WHERE
					MAPPING_YRMN BETWEEN # { fromYrmn }
					AND # { toYrmn }
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND BSCON_CD = 'T0000003'
				GROUP BY
					BSTYP_CD
				UNION ALL
				SELECT
					BSTYP_CD,
					0 AS MNG_CNT,
					0 AS MNG_AMT,
					0 AS COL_CNT,
					0 AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					SUM(PROC_AMT) AS RIAK_MAP,
					0 AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					GIBU.TBRA_DEMD_REPT_BSCON
				WHERE
					MAPPING_YRMN BETWEEN # { fromYrmn }
					AND # { toYrmn }
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND MAPPING_YRMN > REPT_YRMN
					AND BSCON_CD = 'T0000003'
					AND REPT_GBN = '03'
				GROUP BY
					BSTYP_CD
				UNION ALL
				SELECT
					BSTYP_CD,
					0 AS MNG_CNT,
					0 AS MNG_AMT,
					0 AS COL_CNT,
					0 AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					SUM(PROC_AMT) AS RIAK_RETURN,
					0 AS STOMU_AMT
				FROM
					GIBU.TBRA_BSCON_RETURN
				WHERE
					RETURN_YRMN BETWEEN # { fromYrmn }
					AND # { toYrmn }
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND BSCON_CD = 'T0000003'
				GROUP BY
					BSTYP_CD
				UNION ALL
				SELECT
					CC.BSTYP_CD,
					0 AS MNG_CNT,
					0 AS TOT_AMT,
					0 AS COL_UPSO,
					0 AS COL_AMT,
					0 AS MAP_UPSO,
					0 AS MAP_AMT,
					0 AS RETURN_AMT,
					0 AS KOSCAP_AMT,
					0 AS KOSCAP_MAP,
					0 AS KOSCAP_RETURN,
					0 AS FKMP_AMT,
					0 AS FKMP_MAP,
					0 AS FKMP_RETURN,
					0 AS RIAK_AMT,
					0 AS RIAK_MAP,
					0 AS RIAK_RETURN,
					SUM(NVL(AA.REPT_AMT, 0) - NVL(AA.COMIS, 0)) AS STOMU_AMT
				FROM
					(
						SELECT
							REPT_DAY,
							REPT_NUM,
							REPT_AMT,
							COMIS,
							UPSO_CD,
							BRAN_CD,
							MAPPING_DAY
						FROM
							GIBU.TBRA_REPT
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
							AND DISTR_GBN IS NULL
						UNION ALL
						SELECT
							REPT_DAY,
							REPT_NUM,
							DISTR_AMT,
							0,
							UPSO_CD,
							BRAN_CD,
							MAPPING_DAY
						FROM
							GIBU.TBRA_REPT_UPSO_DISTR
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
							AND REPT_GBN <> '08'
						UNION ALL
						SELECT
							A.REPT_DAY,
							A.REPT_NUM,
							(
								CASE
									WHEN MIN(DISTR_SEQ) OVER(PARTITION BY A.REPT_DAY, A.REPT_NUM, A.REPT_GBN) = DISTR_SEQ THEN A.DISTR_AMT - NVL(C.COMIS, 0)
									ELSE A.DISTR_AMT
								END
							) AS REPT_AMT,
							0,
							A.UPSO_CD,
							A.BRAN_CD,
							A.MAPPING_DAY
						FROM
							GIBU.TBRA_REPT_UPSO_DISTR A,
							GIBU.TBRA_REPT_VIRTUAL B,
							GIBU.TBRA_REPT C
						WHERE
							A.MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND A.REPT_DAY = B.REPT_DAY
							AND A.REPT_NUM = B.REPT_NUM
							AND A.REPT_GBN = '08'
							AND A.REPT_DAY = C.REPT_DAY(+)
							AND A.REPT_NUM = C.REPT_NUM(+)
							AND C.REPT_GBN(+) = '08'
					) AA,
					GIBU.TBRA_UPSO BB,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
							(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) CC,
					(
						(
							SELECT
								BSCON_CD,
								BSCON_UPSO_CD,
								UPSO_CD AS KOMCA_UPSO_CD,
								TRUNC(INS_DATE) AS START_DATE,
								TO_DATE('9999-12-31', 'YYYY-MM-DD') AS END_DATE
							FROM
								GIBU.TBRA_STOMU_CONTRINFO
							WHERE
								MOD_DATE IS NULL
								AND UPSO_CD IS NOT NULL
						)
						UNION
						(
							SELECT
								A.BSCON_CD,
								A.BSCON_UPSO_CD,
								A.AFT_CNG AS KOMCA_UPSO_CD,
								A.INS_DATE AS START_DATE,
								LEAD(A.INS_DATE, 1, TO_DATE('9999-12-31', 'YYYY-MM-DD')) OVER (
									PARTITION BY A.BSCON_CD,
									A.BSCON_UPSO_CD
									ORDER BY
										A.SEQ
								) AS END_DATE
							FROM
								(
									SELECT
										BSCON_CD,
										BSCON_UPSO_CD,
										SEQ,
										CNG_COL,
										BEFO_CNG,
										AFT_CNG,
										TRUNC(INS_DATE) AS INS_DATE
									FROM
										GIBU.TBRA_STOMU_HISTY
									WHERE
										1 = 1
										AND CNG_COL = '???????'
								) A
							WHERE
								A.AFT_CNG IS NOT NULL
						)
					) DD,
					(
						SELECT
							BSCON_CD,
							BSCONHAN_NM,
							USE_YN
						FROM
							GIBU.TBRA_BSCON_STOMU
						WHERE
							USE_YN = 'Y'
							AND BSCON_CD IN (
								'04225',
								'22454',
								'H0596',
								'H0739',
								'G0278',
								'06001',
								'02316',
								'G0259',
								'G0327',
								'37227',
								'35194',
								'23247'
							)
					) EE
				WHERE
					AA.UPSO_CD IS NOT NULL
					AND AA.BRAN_CD = DECODE(# { branCd }, 'AL', AA.BRAN_CD, # { branCd })
					AND BB.NEW_DAY IS NOT NULL
					AND BB.NEW_DAY <= # { toYrmn } || '31'
					AND BB.UPSO_CD = AA.UPSO_CD
					AND CC.UPSO_CD = AA.UPSO_CD
					AND DD.KOMCA_UPSO_CD = AA.UPSO_CD
					AND AA.MAPPING_DAY BETWEEN DD.START_DATE
					AND DD.END_DATE
					AND DD.BSCON_CD = EE.BSCON_CD
					AND EE.USE_YN = 'Y'
					AND CC.BSTYP_CD <> 't'
				GROUP BY
					CC.BSTYP_CD
			) TA
			FULL OUTER JOIN (
				SELECT
					BSTYP_CD,
					GRAD_GBN,
					GRADNM,
					STNDAREA_START,
					MDM_CD
				FROM
					GIBU.TBRA_BSTYPGRAD
				WHERE
					BSTYP_CD = 'z'
			) TB ON (TB.GRAD_GBN = TA.BSTYP_CD)
		GROUP BY
			NVL(TB.GRADNM, '???'),
			NVL(TB.STNDAREA_START, 99),
			NVL(TB.MDM_CD, 'Z')
	)
ORDER BY
	ORDER_SEQ1,
	ORDER_SEQ2
</select>

<select id="SQLmon_collect_list_SEL13" parameterType="" resultType="">
SELECT
	BSTYP_NM,
	SUM(COUNT2) AS COL_UPSO,
	SUM(AMT2) AS COL_AMT,
	0 AS MAP_UPSO,
	0 AS MAP_AMT
FROM
	(
		SELECT
			CC.CODE_NM AS BSTYP_NM,
			COUNT(DISTINCT AA.UPSO_CD) AS COUNT2,
			SUM(NVL(AA.REPT_AMT, 0)) - SUM(NVL(AA.COMIS, 0)) AS AMT2,
			1 AS SRT
		FROM
			(
				SELECT
					REPT_AMT,
					COMIS,
					UPSO_CD,
					REPT_GBN,
					BRAN_CD
				FROM
					GIBU.TBRA_REPT
				WHERE
					MAPPING_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND DISTR_GBN IS NULL
				UNION ALL
				SELECT
					DISTR_AMT,
					0,
					UPSO_CD,
					REPT_GBN,
					BRAN_CD
				FROM
					GIBU.TBRA_REPT_UPSO_DISTR
				WHERE
					MAPPING_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND REPT_GBN <> '08'
				UNION ALL
				SELECT
					(
						CASE
							WHEN MIN(DISTR_SEQ) OVER(PARTITION BY A.REPT_DAY, A.REPT_NUM, A.REPT_GBN) = DISTR_SEQ THEN A.DISTR_AMT - NVL(C.COMIS, 0)
							ELSE A.DISTR_AMT
						END
					) AS REPT_AMT,
					0,
					A.UPSO_CD,
					'08',
					A.BRAN_CD
				FROM
					GIBU.TBRA_REPT_UPSO_DISTR A,
					GIBU.TBRA_REPT_VIRTUAL B,
					GIBU.TBRA_REPT C
				WHERE
					A.MAPPING_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND A.REPT_DAY = B.REPT_DAY
					AND A.REPT_NUM = B.REPT_NUM
					AND A.REPT_GBN = '08'
					AND A.REPT_DAY = C.REPT_DAY(+)
					AND A.REPT_NUM = C.REPT_NUM(+)
					AND C.REPT_GBN(+) = '08'
			) AA,
			GIBU.TBRA_UPSO BB,
			FIDU.TENV_CODE CC
		WHERE
			AA.UPSO_CD IS NOT NULL
			AND AA.BRAN_CD = DECODE(# { branCd }, 'AL', AA.BRAN_CD, # { branCd })
			AND BB.NEW_DAY IS NOT NULL
			AND BB.NEW_DAY <= # { toYrmn } || '31'
			AND BB.UPSO_CD = AA.UPSO_CD
			AND CC.HIGH_CD = '00141'
			AND CC.CODE_ETC = 'A'
			AND CC.CODE_CD = AA.REPT_GBN
		GROUP BY
			CC.CODE_NM,
			AA.REPT_GBN
		UNION ALL
		SELECT
			AA.CODE_NM AS BSTYP_NM,
			COUNT2,
			AMT2,
			3 AS SRT
		FROM
			FIDU.TENV_CODE AA,
			(
				SELECT
					'03' AS REPT_GBN,
					COUNT(A.DEMD_NUM) AS COUNT2,
					SUM(NVL(A.REPT_AMT, 0) - NVL(A.ATAX_AMT, 0)) AS AMT2
				FROM
					FIDU.TLEV_USEDEMDREPT A
				WHERE
					A.REPT_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
					AND A.MDM_CD LIKE 'CC04%'
					AND DECODE(# { reptGbn }, NULL, '03', '03', '03', 'X') = '03'
				GROUP BY
					'03'
			) BB
		WHERE
			AA.HIGH_CD = '00141'
			AND AA.CODE_ETC = 'A'
			AND BB.REPT_GBN = AA.CODE_CD
		UNION ALL
		SELECT
			'????????' AS BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) AS COUNT2,
			- SUM(RETURN_AMT) AS AMT2,
			5 AS SRT
		FROM
			GIBU.TBRA_REPT_RETURN A
		WHERE
			A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
			AND A.RETURN_DAY BETWEEN # { fromYrmn } || '01'
			AND # { toYrmn } || '31'
		UNION ALL
		SELECT
			'??????' AS BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) AS COUNT2,
			SUM(RETURN_AMT) AS AMT2,
			4 AS SRT
		FROM
			GIBU.TBRA_REPT_RETURN A
		WHERE
			A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
			AND A.RETURN_DAY BETWEEN # { fromYrmn } || '01'
			AND # { toYrmn } || '31'
			AND A.UPSO_CD IS NULL
		UNION ALL
		SELECT
			'???????¬Û?' AS BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) AS COUNT2,
			- SUM(PROC_AMT) AS AMT2,
			6 AS SRT
		FROM
			GIBU.TBRA_DEMD_REPT_BSCON
		WHERE
			BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
			AND BSCON_CD = 'T0000001'
			AND MAPPING_YRMN BETWEEN # { fromYrmn }
			AND # { toYrmn }
		UNION ALL
		SELECT
			'???????????' AS BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) AS COUNT2,
			SUM(PROC_AMT) AS AMT2,
			7 AS SRT
		FROM
			GIBU.TBRA_BSCON_RETURN
		WHERE
			BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
			AND BSCON_CD = 'T0000001'
			AND RETURN_YRMN BETWEEN # { fromYrmn }
			AND # { toYrmn }
		UNION ALL
		SELECT
			'?????¬Û?' AS BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) AS COUNT2,
			- SUM(PROC_AMT) AS AMT2,
			8 AS SRT
		FROM
			GIBU.TBRA_DEMD_REPT_BSCON
		WHERE
			BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
			AND BSCON_CD = 'T0000002'
			AND MAPPING_YRMN BETWEEN # { fromYrmn }
			AND # { toYrmn }
		UNION ALL
		SELECT
			'??????????' AS BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) AS COUNT2,
			SUM(PROC_AMT) AS AMT2,
			9 AS SRT
		FROM
			GIBU.TBRA_BSCON_RETURN
		WHERE
			BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
			AND BSCON_CD = 'T0000002'
			AND RETURN_YRMN BETWEEN # { fromYrmn }
			AND # { toYrmn }
		UNION ALL
		SELECT
			'???????¬Û?' AS BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) AS COUNT2,
			- SUM(PROC_AMT) AS AMT2,
			10 AS SRT
		FROM
			GIBU.TBRA_DEMD_REPT_BSCON
		WHERE
			BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
			AND BSCON_CD = 'T0000003'
			AND MAPPING_YRMN BETWEEN # { fromYrmn }
			AND # { toYrmn }
		UNION ALL
		SELECT
			'???????????' AS BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) AS COUNT2,
			SUM(PROC_AMT) AS AMT2,
			11 AS SRT
		FROM
			GIBU.TBRA_BSCON_RETURN
		WHERE
			BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
			AND BSCON_CD = 'T0000003'
			AND RETURN_YRMN BETWEEN # { fromYrmn }
			AND # { toYrmn }
	)
WHERE
	AMT2 <> 0
GROUP BY
	BSTYP_NM
ORDER BY
	BSTYP_NM
</select>

<select id="SQLmon_collect_list_SEL5" parameterType="" resultType="">
SELECT
	BSTYP_NM,
	MNG_CNT,
	TOT_AMT,
	COL_UPSO,
	COL_AMT,
	MAP_UPSO,
	MAP_AMT
FROM
(
		SELECT
			NVL(TB.GRADNM, '???') BSTYP_NM,
			SUM(MNG_CNT) MNG_CNT,
			SUM(TOT_AMT) TOT_AMT,
			SUM(COL_UPSO) COL_UPSO,
			SUM(COL_AMT - RETURN_AMT) COL_AMT,
			SUM(MAP_UPSO) MAP_UPSO,
			SUM(MAP_AMT) MAP_AMT
		FROM
(
				SELECT
					TB.BSTYP_CD,
					COUNT(*) MNG_CNT,
					SUM(TB.MONPRNCFEE) TOT_AMT,
					0 COL_UPSO,
					0 COL_AMT,
					0 MAP_UPSO,
					0 MAP_AMT,
					0 RETURN_AMT
				FROM
					GIBU.TBRA_UPSO TA,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) TB
				WHERE
					TA.BRAN_CD = DECODE(# { branCd }, 'AL', TA.BRAN_CD, # { branCd })
					AND TA.NEW_DAY IS NOT NULL
					AND TA.NEW_DAY <= # { toYrmn } || '31'
					AND (
						TA.CLSBS_YRMN IS NULL
						OR NVL(SUBSTR(TA.CLSBS_INS_DAY, 1, 6), '  ') > # { toYrmn }
					)
					AND TB.UPSO_CD = TA.UPSO_CD
				GROUP BY
					TB.BSTYP_CD
				UNION ALL
				SELECT
					CC.BSTYP_CD,
					0 MNG_CNT,
					0 TOT_AMT,
					COUNT(DISTINCT AA.UPSO_CD),
					SUM(NVL(AA.REPT_AMT, 0) - NVL(AA.COMIS, 0)),
					0 MAP_UPSO,
					0 MAP_AMT,
					0 RETURN_AMT
				FROM
					(
						SELECT
							REPT_DAY,
							REPT_NUM,
							REPT_AMT,
							COMIS,
							UPSO_CD
						FROM
							GIBU.TBRA_REPT
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND DISTR_GBN IS NULL
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
						UNION ALL
						SELECT
							REPT_DAY,
							REPT_NUM,
							DISTR_AMT,
							0,
							UPSO_CD
						FROM
							GIBU.TBRA_REPT_UPSO_DISTR
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					) AA,
					GIBU.TBRA_UPSO BB,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) CC
				WHERE
					AA.UPSO_CD IS NOT NULL
					AND BB.NEW_DAY IS NOT NULL
					AND BB.NEW_DAY <= # { toYrmn } || '31'
					AND BB.UPSO_CD = AA.UPSO_CD
					AND CC.UPSO_CD = AA.UPSO_CD
				GROUP BY
					CC.BSTYP_CD
				UNION ALL
				SELECT
					CC.BSTYP_CD,
					0,
					0,
					0,
					0,
					0,
					0,
					SUM(RETURN_AMT) RETURN_AMT
				FROM
					GIBU.TBRA_REPT_RETURN A,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) CC
				WHERE
					A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
					AND A.RETURN_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND A.UPSO_CD = CC.UPSO_CD
				GROUP BY
					CC.BSTYP_CD
				UNION ALL
				SELECT
					CC.BSTYP_CD,
					0,
					0,
					0,
					0,
					COUNT(DISTINCT AA.UPSO_CD),
					SUM(NVL(AA.REPT_AMT, 0) - NVL(AA.COMIS, 0)),
					0 RETURN_AMT
				FROM
					(
						SELECT
							REPT_DAY,
							REPT_NUM,
							REPT_AMT,
							COMIS,
							UPSO_CD
						FROM
							GIBU.TBRA_REPT
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND DISTR_GBN IS NULL
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
							AND SUBSTR(REPT_DAY, 1, 6) <> SUBSTR(MAPPING_DAY, 1, 6)
						UNION ALL
						SELECT
							REPT_DAY,
							REPT_NUM,
							DISTR_AMT,
							0,
							UPSO_CD
						FROM
							GIBU.TBRA_REPT_UPSO_DISTR
						WHERE
							MAPPING_DAY BETWEEN # { fromYrmn } || '01'
							AND # { toYrmn } || '31'
							AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
							AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
							AND SUBSTR(REPT_DAY, 1, 6) <> SUBSTR(MAPPING_DAY, 1, 6)
					) AA,
					GIBU.TBRA_UPSO BB,
					(
						SELECT
							ZA.UPSO_CD,
							ZB.MONPRNCFEE,
							ZC.GRADNM,
							ZB.BSTYP_CD,
							ZB.UPSO_GRAD
						FROM
(
								SELECT
									A.UPSO_CD,
									MAX(A.JOIN_SEQ) JOIN_SEQ
								FROM
									GIBU.TBRA_UPSORTAL_INFO A,
									GIBU.TBRA_UPSO B
								WHERE
									B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
									AND A.UPSO_CD = B.UPSO_CD
								GROUP BY
									A.UPSO_CD
							) ZA,
							GIBU.TBRA_UPSORTAL_INFO ZB,
							GIBU.TBRA_BSTYPGRAD ZC
						WHERE
							ZB.JOIN_SEQ = ZA.JOIN_SEQ
							AND ZB.UPSO_CD = ZA.UPSO_CD
							AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
							AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
					) CC
				WHERE
					AA.UPSO_CD IS NOT NULL
					AND BB.NEW_DAY IS NOT NULL
					AND BB.NEW_DAY <= # { toYrmn } || '31'
					AND BB.UPSO_CD = AA.UPSO_CD
					AND CC.UPSO_CD = AA.UPSO_CD
				GROUP BY
					CC.BSTYP_CD
			) TA,
			GIBU.TBRA_BSTYPGRAD TB
		WHERE
			TB.BSTYP_CD(+) = 'z'
			AND TB.GRAD_GBN(+) = TA.BSTYP_CD
		GROUP BY
			NVL(TB.GRADNM, '???')
	)
WHERE
	MNG_CNT IS NOT NULL
	AND COL_UPSO IS NOT NULL
ORDER BY
	MNG_CNT DESC
</select>

<select id="SQLmon_collect_list_SEL6" parameterType="" resultType="">
SELECT
	BSTYP_NM,
	SUM(COUNT2) COL_UPSO,
	SUM(AMT2) COL_AMT,
	0 MAP_UPSO,
	0 MAP_AMT
FROM
	(
		SELECT
			CC.CODE_NM BSTYP_NM,
			COUNT(DISTINCT AA.UPSO_CD) COUNT2,
			SUM(NVL(AA.REPT_AMT, 0)) - SUM(NVL(AA.COMIS, 0)) AMT2
		FROM
			(
				SELECT
					REPT_AMT,
					COMIS,
					UPSO_CD,
					REPT_GBN
				FROM
					GIBU.TBRA_REPT
				WHERE
					MAPPING_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
					AND DISTR_GBN IS NULL
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
				UNION ALL
				SELECT
					DISTR_AMT,
					0,
					UPSO_CD,
					REPT_GBN
				FROM
					GIBU.TBRA_REPT_UPSO_DISTR
				WHERE
					MAPPING_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
			) AA,
			GIBU.TBRA_UPSO BB,
			FIDU.TENV_CODE CC
		WHERE
			AA.UPSO_CD IS NOT NULL
			AND BB.NEW_DAY IS NOT NULL
			AND BB.NEW_DAY <= # { toYrmn } || '31'
			AND BB.UPSO_CD = AA.UPSO_CD
			AND CC.HIGH_CD = '00141'
			AND CC.CODE_ETC = 'A'
			AND CC.CODE_CD = AA.REPT_GBN
		GROUP BY
			CC.CODE_NM,
			AA.REPT_GBN
		UNION ALL
		SELECT
			'????????' BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) COUNT2,
			- SUM(RETURN_AMT) AMT2
		FROM
			GIBU.TBRA_REPT_RETURN A
		WHERE
			A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
			AND A.RETURN_DAY BETWEEN # { fromYrmn } || '01'
			AND # { toYrmn } || '31'
		UNION ALL
		--???????  ???????  ???  ?????????  ???  ????,  ??????????????????  ???????
		SELECT
			'??????' BSTYP_NM,
			COUNT(DISTINCT UPSO_CD) COUNT2,
			SUM(RETURN_AMT) AMT2
		FROM
			GIBU.TBRA_REPT_RETURN A
		WHERE
			A.BRAN_CD = DECODE(# { branCd }, 'AL', A.BRAN_CD, # { branCd })
			AND A.RETURN_DAY BETWEEN # { fromYrmn } || '01'
			AND # { toYrmn } || '31'
			AND A.UPSO_CD IS NULL
	)
GROUP BY
	BSTYP_NM
ORDER BY
	1
</select>

<select id="SQLstomu_list_SEL1" parameterType="" resultType="">
SELECT
	BBB.BSCONHAN_NM,
	NVL(AAA.STOMU_COL, 0) AS STOMU_COL,
	NVL(AAA.STOMU_AMT, 0) AS STOMU_AMT
FROM
	(
		SELECT
			DD.BSCON_CD,
			COUNT(NVL(AA.REPT_AMT, 0)) AS STOMU_COL,
			SUM(NVL(AA.REPT_AMT, 0) - NVL(AA.COMIS, 0)) AS STOMU_AMT
		FROM
			(
				SELECT
					REPT_DAY,
					REPT_NUM,
					REPT_AMT,
					COMIS,
					UPSO_CD,
					BRAN_CD,
					MAPPING_DAY
				FROM
					GIBU.TBRA_REPT
				WHERE
					MAPPING_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND DISTR_GBN IS NULL
				UNION ALL
				SELECT
					REPT_DAY,
					REPT_NUM,
					DISTR_AMT,
					0,
					UPSO_CD,
					BRAN_CD,
					MAPPING_DAY
				FROM
					GIBU.TBRA_REPT_UPSO_DISTR
				WHERE
					MAPPING_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND REPT_GBN = DECODE(# { reptGbn }, NULL, REPT_GBN, # { reptGbn })
					AND BRAN_CD = DECODE(# { branCd }, 'AL', BRAN_CD, # { branCd })
					AND REPT_GBN <> '08'
				UNION ALL
				SELECT
					A.REPT_DAY,
					A.REPT_NUM,
					(
						CASE
							WHEN MIN(DISTR_SEQ) OVER(PARTITION BY A.REPT_DAY, A.REPT_NUM, A.REPT_GBN) = DISTR_SEQ THEN A.DISTR_AMT - NVL(C.COMIS, 0)
							ELSE A.DISTR_AMT
						END
					) AS REPT_AMT,
					0,
					A.UPSO_CD,
					A.BRAN_CD,
					A.MAPPING_DAY
				FROM
					GIBU.TBRA_REPT_UPSO_DISTR A,
					GIBU.TBRA_REPT_VIRTUAL B,
					GIBU.TBRA_REPT C
				WHERE
					A.MAPPING_DAY BETWEEN # { fromYrmn } || '01'
					AND # { toYrmn } || '31'
					AND A.REPT_DAY = B.REPT_DAY
					AND A.REPT_NUM = B.REPT_NUM
					AND A.REPT_GBN = '08'
					AND A.REPT_DAY = C.REPT_DAY(+)
					AND A.REPT_NUM = C.REPT_NUM(+)
					AND C.REPT_GBN(+) = '08'
			) AA,
			GIBU.TBRA_UPSO BB,
			(
				SELECT
					ZA.UPSO_CD,
					ZB.MONPRNCFEE,
					ZC.GRADNM,
					ZB.BSTYP_CD,
					ZB.UPSO_GRAD
				FROM
					(
						SELECT
							A.UPSO_CD,
							MAX(A.JOIN_SEQ) JOIN_SEQ
						FROM
							GIBU.TBRA_UPSORTAL_INFO A,
							GIBU.TBRA_UPSO B
						WHERE
							B.BRAN_CD = DECODE(# { branCd }, 'AL', B.BRAN_CD, # { branCd })
							AND A.UPSO_CD = B.UPSO_CD
						GROUP BY
							A.UPSO_CD
					) ZA,
					GIBU.TBRA_UPSORTAL_INFO ZB,
					GIBU.TBRA_BSTYPGRAD ZC
				WHERE
					ZB.JOIN_SEQ = ZA.JOIN_SEQ
					AND ZB.UPSO_CD = ZA.UPSO_CD
					AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
					AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
			) CC,
			(
				(
					SELECT
						BSCON_CD,
						BSCON_UPSO_CD,
						UPSO_CD AS KOMCA_UPSO_CD,
						TRUNC(INS_DATE) AS START_DATE,
						TO_DATE('9999-12-31', 'YYYY-MM-DD') AS END_DATE
					FROM
						GIBU.TBRA_STOMU_CONTRINFO
					WHERE
						MOD_DATE IS NULL
						AND UPSO_CD IS NOT NULL
				)
				UNION
				(
					SELECT
						A.BSCON_CD,
						A.BSCON_UPSO_CD,
						A.AFT_CNG AS KOMCA_UPSO_CD,
						A.INS_DATE AS START_DATE,
						LEAD(A.INS_DATE, 1, TO_DATE('9999-12-31', 'YYYY-MM-DD')) OVER (
							PARTITION BY A.BSCON_CD,
							A.BSCON_UPSO_CD
							ORDER BY
								A.SEQ
						) AS END_DATE
					FROM
						(
							SELECT
								BSCON_CD,
								BSCON_UPSO_CD,
								SEQ,
								CNG_COL,
								BEFO_CNG,
								AFT_CNG,
								TRUNC(INS_DATE) AS INS_DATE
							FROM
								GIBU.TBRA_STOMU_HISTY
							WHERE
								1 = 1
								AND CNG_COL = '???????'
						) A
					WHERE
						A.AFT_CNG IS NOT NULL
				)
			) DD
		WHERE
			AA.UPSO_CD IS NOT NULL
			AND AA.BRAN_CD = DECODE(# { branCd }, 'AL', AA.BRAN_CD, # { branCd })
			AND BB.NEW_DAY IS NOT NULL
			AND BB.NEW_DAY <= # { toYrmn } || '31'
			AND BB.UPSO_CD = AA.UPSO_CD
			AND CC.UPSO_CD = AA.UPSO_CD
			AND DD.KOMCA_UPSO_CD = AA.UPSO_CD
			AND AA.MAPPING_DAY BETWEEN DD.START_DATE
			AND DD.END_DATE
			AND GIBU.FT_GET_BSTYP_NM(CC.BSTYP_CD) = # { bstypNm }
		GROUP BY
			DD.BSCON_CD
	) AAA
	RIGHT OUTER JOIN (
		SELECT
			BSCON_CD,
			BSCONHAN_NM,
			USE_YN
		FROM
			GIBU.TBRA_BSCON_STOMU
		WHERE
			USE_YN = 'Y'
			AND BSCON_CD IN (
				'04225',
				'22454',
				'H0596',
				'H0739',
				'G0278',
				'06001',
				'02316',
				'G0259',
				'G0327',
				'37227',
				'35194',
				'23247'
			)
	) BBB ON AAA.BSCON_CD = BBB.BSCON_CD
ORDER BY
	BBB.BSCONHAN_NM
</select>

</mapper>