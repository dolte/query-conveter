<mapper namespace="kr.or.komca.center..mapper.Mapper">
<select id="SQLcol_upso_list_SEL1" parameterType="" resultType="">
SELECT
	AA.UPSO_CD,
	CC.GRADNM,
	CC.MONPRNCFEE,
	BB.UPSO_NM,
	BB.MNGEMSTR_NM,
	BB.UPSO_ADDR,
	BB.UPSO_PHON,
	AA.START_YRMN || '~' || AA.END_YRMN YRMN,
	NVL(AA.REPT_AMT, 0) - NVL(AA.COMIS, 0) REPT_AMT,
	BB.STAFF_NM,
	DECODE(AA.ACCU_GBN, NULL, '', '??????') REMAK,
	DECODE(AA.ACCU_GBN, NULL, 0, 1) CNT
FROM
	(
		SELECT
			TA.REPT_DAY,
			TA.REPT_NUM,
			TA.REPT_GBN,
			'-' DISTR_SEQ,
			TA.REPT_AMT,
			TA.COMIS,
			TA.UPSO_CD,
			TB.START_YRMN,
			TB.END_YRMN,
			TB.ACCU_GBN
		FROM
			GIBU.TBRA_REPT TA,
			(
				SELECT
					UPSO_CD,
					REPT_DAY,
					REPT_NUM,
					REPT_GBN,
					ACCU_GBN,
					MIN(NOTE_YRMN) START_YRMN,
					MAX(NOTE_YRMN) END_YRMN
				FROM
					GIBU.TBRA_NOTE
				WHERE
					BRAN_CD = # { branCd }
					AND MAPPING_DAY LIKE # { yrmn } || '%'
				GROUP BY
					UPSO_CD,
					REPT_DAY,
					REPT_NUM,
					REPT_GBN,
					ACCU_GBN
			) TB
		WHERE
			TA.MAPPING_DAY LIKE # { yrmn } || '%'
			AND TA.DISTR_GBN IS NULL
			AND TA.BRAN_CD = # { branCd }
			AND TB.UPSO_CD (+) = TA.UPSO_CD
			AND TB.REPT_DAY(+) = TA.REPT_DAY
			AND TB.REPT_NUM(+) = TA.REPT_NUM
			AND TB.REPT_GBN(+) = TA.REPT_GBN
		UNION ALL
		SELECT
			TA.REPT_DAY,
			TA.REPT_NUM,
			TA.REPT_GBN,
			TA.DISTR_SEQ,
			TA.DISTR_AMT,
			0,
			TA.UPSO_CD,
			TB.START_YRMN,
			TB.END_YRMN,
			TB.ACCU_GBN
		FROM
			GIBU.TBRA_REPT_UPSO_DISTR TA,
			(
				SELECT
					UPSO_CD,
					REPT_DAY,
					REPT_NUM,
					REPT_GBN,
					DISTR_SEQ,
					ACCU_GBN,
					MIN(NOTE_YRMN) START_YRMN,
					MAX(NOTE_YRMN) END_YRMN
				FROM
					GIBU.TBRA_NOTE
				WHERE
					BRAN_CD = # { branCd }
					AND MAPPING_DAY LIKE # { yrmn } || '%'
					AND DISTR_SEQ IS NOT NULL
				GROUP BY
					UPSO_CD,
					REPT_DAY,
					REPT_NUM,
					REPT_GBN,
					DISTR_SEQ,
					ACCU_GBN
			) TB
		WHERE
			TA.MAPPING_DAY LIKE # { yrmn } || '%'
			AND TA.BRAN_CD = # { branCd }
			AND TB.UPSO_CD (+) = TA.UPSO_CD
			AND TB.REPT_DAY (+) = TA.REPT_DAY
			AND TB.REPT_NUM (+) = TA.REPT_NUM
			AND TB.REPT_GBN (+) = TA.REPT_GBN
			AND TB.DISTR_SEQ(+) = TA.DISTR_SEQ
	) AA,
	(
		SELECT
			TA.UPSO_CD,
			TA.UPSO_NM,
			TA.MNGEMSTR_NM,
			TA.STAFF_CD,
			TB.HAN_NM STAFF_NM,
			TA.UPSO_NEW_ADDR1 || DECODE(TA.UPSO_NEW_ADDR2, '', '', ',  ' || TA.UPSO_NEW_ADDR2) || TA.UPSO_REF_INFO UPSO_ADDR,
			TA.NEW_DAY,
			TA.UPSO_PHON
		FROM
			GIBU.TBRA_UPSO TA,
			INSA.TINS_MST01 TB
		WHERE
			TB.STAFF_NUM(+) = TA.STAFF_CD
	) BB,
	(
		SELECT
			ZA.UPSO_CD,
			ZB.MONPRNCFEE,
			ZC.GRADNM,
			ZB.BSTYP_CD,
			ZB.UPSO_GRAD
		FROM
(
				SELECT
					A.UPSO_CD,
					MAX(A.JOIN_SEQ) JOIN_SEQ
				FROM
					GIBU.TBRA_UPSORTAL_INFO A,
					GIBU.TBRA_UPSO B
				WHERE
					B.BRAN_CD = # { branCd }
					AND A.UPSO_CD = B.UPSO_CD
				GROUP BY
					A.UPSO_CD
			) ZA,
			GIBU.TBRA_UPSORTAL_INFO ZB,
			GIBU.TBRA_BSTYPGRAD ZC
		WHERE
			ZB.JOIN_SEQ = ZA.JOIN_SEQ
			AND ZB.UPSO_CD = ZA.UPSO_CD
			AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
			AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
	) CC
WHERE
	AA.UPSO_CD IS NOT NULL
	AND BB.NEW_DAY IS NOT NULL
	AND BB.NEW_DAY <= # { yrmn } || '31'
	AND BB.UPSO_CD = AA.UPSO_CD
	AND CC.UPSO_CD = AA.UPSO_CD
ORDER BY
	UPSO_CD
</select>

<select id="SQLcol_upso_list_SEL4" parameterType="" resultType="">
SELECT
	AA.UPSO_CD,
	CC.GRADNM,
	CC.MONPRNCFEE,
	BB.UPSO_NM,
	BB.MNGEMSTR_NM,
	BB.UPSO_ADDR,
	BB.UPSO_PHON,
	BB.START_YRMN || '~' || BB.END_YRMN YRMN,
	NVL(AA.REPT_AMT, 0) - NVL(AA.COMIS, 0) REPT_AMT,
	BB.STAFF_NM
FROM
	(
		SELECT
			REPT_DAY,
			REPT_NUM,
			REPT_AMT,
			COMIS,
			UPSO_CD
		FROM
			GIBU.TBRA_REPT
		WHERE
			MAPPING_DAY LIKE # { yrmn } || '%'
			AND DISTR_GBN IS NULL
			AND BRAN_CD = # { branCd }
		UNION ALL
		SELECT
			REPT_DAY,
			REPT_NUM,
			DISTR_AMT,
			0,
			UPSO_CD
		FROM
			GIBU.TBRA_REPT_UPSO_DISTR
		WHERE
			MAPPING_DAY LIKE # { yrmn } || '%'
			AND BRAN_CD = # { branCd }
	) AA,
	(
		SELECT
			TA.UPSO_CD,
			TB.UPSO_NM,
			TB.MNGEMSTR_NM,
			TB.STAFF_CD,
			TC.HAN_NM STAFF_NM,
			TB.UPSO_NEW_ADDR1 || DECODE(TB.UPSO_NEW_ADDR2, '', '', ',  ' || TB.UPSO_NEW_ADDR2) || TB.UPSO_REF_INFO UPSO_ADDR,
			TA.START_YRMN,
			TA.END_YRMN,
			TB.NEW_DAY,
			TB.UPSO_PHON
		FROM
			(
				SELECT
					ZB.UPSO_CD,
					MIN(ZA.NOTE_YRMN) START_YRMN,
					MAX(ZA.NOTE_YRMN) END_YRMN
				FROM
					GIBU.TBRA_NOTE ZA,
					(
						SELECT
							UPSO_CD,
							REPT_DAY,
							REPT_NUM,
							REPT_GBN
						FROM
							GIBU.TBRA_REPT
						WHERE
							MAPPING_DAY LIKE # { yrmn } || '%'
							AND BRAN_CD = # { branCd }
						UNION
						SELECT
							UPSO_CD,
							REPT_DAY,
							REPT_NUM,
							REPT_GBN
						FROM
							GIBU.TBRA_REPT_UPSO_DISTR
						WHERE
							MAPPING_DAY LIKE # { yrmn } || '%'
							AND BRAN_CD = # { branCd }
					) ZB
				WHERE
					ZA.UPSO_CD(+) = ZB.UPSO_CD
					AND ZA.REPT_DAY(+) = ZB.REPT_DAY
					AND ZA.REPT_NUM(+) = ZB.REPT_NUM
					AND ZA.REPT_GBN(+) = ZB.REPT_GBN
				GROUP BY
					ZB.UPSO_CD
			) TA,
			GIBU.TBRA_UPSO TB,
			INSA.TINS_MST01 TC
		WHERE
			TA.UPSO_CD = TB.UPSO_CD
			AND TC.STAFF_NUM(+) = TB.STAFF_CD
	) BB,
	(
		SELECT
			ZA.UPSO_CD,
			ZB.MONPRNCFEE,
			ZC.GRADNM,
			ZB.BSTYP_CD,
			ZB.UPSO_GRAD
		FROM
(
				SELECT
					A.UPSO_CD,
					MAX(A.JOIN_SEQ) JOIN_SEQ
				FROM
					GIBU.TBRA_UPSORTAL_INFO A,
					GIBU.TBRA_UPSO B
				WHERE
					B.BRAN_CD = # { branCd }
					AND A.UPSO_CD = B.UPSO_CD
				GROUP BY
					A.UPSO_CD
			) ZA,
			GIBU.TBRA_UPSORTAL_INFO ZB,
			GIBU.TBRA_BSTYPGRAD ZC
		WHERE
			ZB.JOIN_SEQ = ZA.JOIN_SEQ
			AND ZB.UPSO_CD = ZA.UPSO_CD
			AND ZC.BSTYP_CD(+) = ZB.BSTYP_CD
			AND ZC.GRAD_GBN(+) = ZB.UPSO_GRAD
	) CC
WHERE
	AA.UPSO_CD IS NOT NULL
	AND (
		BB.NEW_DAY > # { yrmn } || '32'
		OR BB.NEW_DAY IS NULL
	)
	AND BB.UPSO_CD = AA.UPSO_CD
	AND CC.UPSO_CD = AA.UPSO_CD
ORDER BY
	UPSO_CD
</select>

</mapper>