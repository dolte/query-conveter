<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="800" Id="form" Left="8" OnLoadCompleted="form_OnLoadCompleted" PidAttrib="7" Title="미수금&#32;장부" Top="8" Ver="1.0" Width="1288" WorkArea="true">
		<Datasets>
			<Dataset Auto="false" DataSetType="Dataset" Id="ds_list" UseClientLayout="1">
				<Contents>
					<colinfo id="NONPY_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="STAFF_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="STAFF_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="BEFORE_NONPY_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="DEMD_AMT" size="256" summ="default" type="INT"/>
					<colinfo id="ADDT_AMT" size="256" summ="default" type="INT"/>
					<colinfo id="EADDT_AMT" size="256" summ="default" type="INT"/>
					<colinfo id="DEMD_MMCNT" size="256" summ="default" type="INT"/>
					<colinfo id="REPT_AMT" size="256" summ="default" type="INT"/>
					<colinfo id="COMIS_AMT" size="256" summ="default" type="INT"/>
					<colinfo id="RETURN_AMT" size="256" summ="default" type="INT"/>
					<colinfo id="RETURN_COMIS_AMT" size="256" summ="default" type="INT"/>
					<colinfo id="ADJ_AMT" size="256" summ="default" type="INT"/>
					<colinfo id="NONPY_AMT" size="256" summ="default" type="INT"/>
					<colinfo id="COMPN_DATE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_search">
				<Contents>
					<colinfo id="BRAN_CD" size="256" type="STRING"/>
					<colinfo id="UPSO_CD" size="256" type="STRING"/>
					<colinfo id="START_DAY" size="256" type="STRING"/>
					<colinfo id="END_DAY" size="256" type="STRING"/>
					<colinfo id="STAFF_CD" size="256" type="STRING"/>
					<record>
						<BRAN_CD></BRAN_CD>
						<END_DAY></END_DAY>
						<STAFF_CD></STAFF_CD>
						<START_DAY></START_DAY>
						<UPSO_CD></UPSO_CD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_sawon">
				<Contents>
					<colinfo id="STAFF_CD" size="256" type="STRING"/>
					<colinfo id="STAFF_NM" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_bran_cd">
				<Contents>
					<colinfo id="BRAN_CD" size="256" summ="default" type="STRING"/>
					<record>
						<BRAN_CD></BRAN_CD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_wonjang">
				<Contents>
					<colinfo id="BB_UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="BB_REPT_YRMN" size="256" summ="default" type="STRING"/>
					<colinfo id="BB_MM" size="256" summ="default" type="STRING"/>
					<colinfo id="BB_REPT_GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="BB_CODE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="BB_USE_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="BB_REPT_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="BB_RECV_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="BB_MAPPING_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="B_UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="B_REPT_YRMN" size="256" summ="default" type="STRING"/>
					<colinfo id="B_MM" size="256" summ="default" type="STRING"/>
					<colinfo id="B_REPT_GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="B_CODE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="B_USE_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="B_REPT_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="B_RECV_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="B_MAPPING_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="REPT_YRMN" size="256" summ="default" type="STRING"/>
					<colinfo id="MM" size="256" summ="default" type="STRING"/>
					<colinfo id="REPT_GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="USE_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="REPT_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="RECV_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="MAPPING_DAY" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_search2">
				<Contents>
					<colinfo id="UPSO_CD" size="256" type="STRING"/>
					<colinfo id="YEAR" size="256" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Image FillType="STRETCH" Height="41" Id="Image15" ImageID="C_search_bg" Left="16" TabOrder="0" TabStop="FALSE" Top="8" Width="1000"></Image>
		<Image Height="41" Id="Image17" ImageID="C_search_left" Left="9" TabOrder="0" TabStop="FALSE" Top="8" Width="10"></Image>
		<Image Height="41" Id="Image18" ImageID="C_search_right" Left="1016" TabOrder="0" TabStop="FALSE" Top="8" Width="12"></Image>
		<Image Height="11" Id="Image16" ImageID="C_icon" Left="22" TabOrder="0" TabStop="FALSE" Top="23" Width="11"></Image>
		<Static Height="15" Id="Static5" Left="36" Style="tx_left_bold" TabOrder="1" Text="지부명" Top="24" Width="40"></Static>
		<Image Height="11" Id="Image2" ImageID="C_icon" Left="182" TabOrder="1" TabStop="FALSE" Top="23" Width="11"></Image>
		<Static Height="15" Id="Static15" Left="196" Style="tx_left_bold" TabOrder="1" Text="업소코드/명" Top="23" Width="70"></Static>
		<Edit Border="Flat" BorderColor="user10" Height="20" Id="edt_UPSO_NM" ImeMode="native,katakana" Left="343" LeftMargin="2" OnKeyDown="edt_UPSO_NM_OnKeyDown" Style="edit" TabOrder="0" Top="19" Width="120"></Edit>
		<Button Cursor="HAND" Height="21" Id="btn_FindUpso" ImageID="C_btn_search" Left="466" OnClick="btn_FindUpso_OnClick" TabOrder="2" TabStop="FALSE" Top="19" Width="58"></Button>
		<Combo BKColor="user13" Column="BRAN_CD" Height="20" Id="cob_BRAN_CD" Left="81" OnChanged="cob_BRAN_CD_OnChanged" TabOrder="0" ToolTipText="지부명" Top="16" Width="80"></Combo>
		<Edit BindDataset="ds_search" Border="Flat" BorderColor="user10" Column="UPSO_CD" Height="20" Id="edt_UPSO_CD" Left="270" LeftMargin="2" MaxLength="8" OnChar="edt_UPSO_CD_OnChar" OnKeyDown="edt_UPSO_CD_OnKeyDown" Style="edit" TabOrder="0" ToolTipText="업소코드" Top="19" UseIME="FALSE" Width="70"></Edit>
		<Image Height="17" Id="Image0" ImageID="C_icon2" Left="24" TabOrder="13" Top="59" Width="18"></Image>
		<Static Color="user1" Height="11" Id="Static0" Left="48" Style="tx_bold" TabOrder="12" Text="미수금&#32;장부" Top="62" Width="400"></Static>
		<Grid BindDataset="ds_list" BkColor2="user11" BkSelColor="user9" BoldHead="true" Border="Flat" BorderColor="user3" Bottom="480" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" Face3dColor="user8" HeadHeight="23" Height="400" Id="grd_list" InputPanel="FALSE" Left="16" LineColor="default" OnCellPosChanged="grd_list_OnCellPosChanged" OnExpandEdit="grd_bank_OnExpandEdit" Right="1272" RowHeight="20" Style="grid" TabOrder="14" TabStop="true" Top="80" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1256">
			<contents>
				<format id="Default">
					<columns>
						<col width="67"/>
						<col width="67"/>
						<col width="80"/>
						<col width="250"/>
						<col width="65"/>
						<col width="90"/>
						<col width="90"/>
						<col width="90"/>
						<col width="74"/>
						<col width="90"/>
						<col width="95"/>
						<col width="77"/>
						<col width="90"/>
					</columns>
					<head>
						<cell col="0" color="user12" display="text" text="일자"/>
						<cell col="1" color="user12" display="text" text="지부명"/>
						<cell col="2" color="user12" display="text" text="업소코드"/>
						<cell col="3" color="user12" display="text" text="업소명"/>
						<cell col="4" color="user12" display="text" text="담당자"/>
						<cell col="5" color="user12" display="text" text="전일미수"/>
						<cell col="6" color="user12" display="text" text="당일청구"/>
						<cell col="7" color="user12" display="text" text="당일입금"/>
						<cell col="8" color="user12" display="text" text="당일수수료"/>
						<cell col="9" color="user12" display="text" text="당일반환"/>
						<cell col="10" color="user12" display="text" text="당일반환수수료"/>
						<cell col="11" color="user12" display="text" text="정정금액"/>
						<cell col="12" color="user12" display="text" text="당일미수"/>
					</head>
					<body>
						<cell align="center" col="0" colid="NONPY_DAY" display="date" limit="8" Mask="yyyy-MM-dd"/>
						<cell align="center" col="1" colid="BRAN_NM" display="text"/>
						<cell align="center" col="2" colid="UPSO_CD" display="text"/>
						<cell col="3" colid="UPSO_NM" display="text"/>
						<cell align="center" col="4" colid="STAFF_NM" display="text"/>
						<cell col="5" colid="BEFORE_NONPY_AMT" display="numberexp" limit="10"/>
						<cell col="6" colid="DEMD_AMT" display="number" limit="10"/>
						<cell col="7" colid="REPT_AMT" display="number" limit="10"/>
						<cell col="8" colid="COMIS_AMT" display="number" limit="10"/>
						<cell col="9" colid="RETURN_AMT" display="number" limit="10"/>
						<cell col="10" colid="RETURN_COMIS_AMT" display="number" limit="10"/>
						<cell col="11" colid="ADJ_AMT" display="number" limit="10"/>
						<cell col="12" colid="NONPY_AMT" display="number" limit="10"/>
					</body>
					<summary>
						<cell col="0" colspan="5" display="text">
							<cell col="0" display="text"/>
							<cell col="1" display="text"/>
							<cell col="2" display="text"/>
							<cell col="3" display="text"/>
							<cell col="4" display="text"/>
						</cell>
						<cell col="5" display="number" expr='SUM(&quot;BEFORE_NONPY_AMT&quot;)'/>
						<cell col="6" display="number" expr='SUM(&quot;DEMD_AMT&quot;)'/>
						<cell col="7" display="number" expr='SUM(&quot;REPT_AMT&quot;)'/>
						<cell col="8" display="number" expr='SUM(&quot;COMIS_AMT&quot;)'/>
						<cell col="9" display="number" expr='SUM(&quot;RETURN_AMT&quot;)'/>
						<cell col="10" display="number" expr='SUM(&quot;RETURN_COMIS_AMT&quot;)'/>
						<cell col="11" display="number" expr='SUM(&quot;ADJ_AMT&quot;)'/>
						<cell col="12" display="number" expr='SUM(&quot;NONPY_AMT&quot;)'/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Image Height="11" Id="Image12" ImageID="C_icon" Left="554" TabOrder="17" TabStop="FALSE" Top="23" Width="11"></Image>
		<Static Color="user12" Height="11" Id="Static7" Left="568" Style="tx_left_bold" TabOrder="18" Text="일자" Top="23" Width="60"></Static>
		<Calendar BKColor="user13" Dateformat="yyyy/MM/dd" DayStyle="edit" Height="20" Id="cal_Sday" Left="598" LeftMargin="5" MonthPickerFormat="yyyy년&#32;MM월" SaturdayTextColor="blue" SundayTextColor="red" TabOrder="15" ToolTipText="기간_S" Top="18" Width="101"></Calendar>
		<Static Enable="FALSE" Height="20" Id="Static1" Left="701" TabOrder="19" Text="~" Top="22" Visible="FALSE" Width="14"></Static>
		<Calendar Dateformat="yyyy/MM/dd" DayStyle="edit" Enable="FALSE" Height="20" Id="cal_Eday" Left="716" LeftMargin="5" MonthPickerFormat="yyyy년&#32;MM월" SaturdayTextColor="blue" SundayTextColor="red" TabOrder="16" ToolTipText="기간_E" Top="18" Visible="FALSE" Width="101"></Calendar>
		<Image Height="11" Id="img_emp" ImageID="C_icon" Left="836" TabOrder="21" TabStop="FALSE" Top="23" Width="11"></Image>
		<Static Height="14" Id="st_emp" Left="849" Style="tx_left_bold" TabOrder="22" Text="사원명" Top="24" Width="38"></Static>
		<Combo CodeColumn="STAFF_CD" DataColumn="STAFF_NM" Height="20" Id="cob_Staff_Nm" ImeMode="none" INDEX="1" InnerDataset="ds_sawon" Left="891" TabOrder="20" ToolTipText="사원명" Top="18" Width="80"></Combo>
		<Grid BindDataset="ds_wonjang" BkColor2="user11" BkSelColor="user9" BoldHead="true" Border="Flat" Bottom="798" ColSelect="TRUE" Enable="true" EndLineColor="default" Face3dColor="user8" HeadHeight="23" Height="288" Id="grd_wonjang" InputPanel="FALSE" Left="16" LineColor="silver" OnCellClick="grd_wonjang_OnCellClick" OnHeadClick="grd_wonjang_OnHeadClick" Right="1024" RowHeight="20" Style="grid" TabOrder="23" TabStop="FALSE" Top="510" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1008">
			<contents>
				<format id="Default">
					<columns>
						<col width="31"/>
						<col width="79"/>
						<col width="80"/>
						<col width="80"/>
						<col width="85"/>
						<col width="79"/>
						<col width="80"/>
						<col width="80"/>
						<col width="85"/>
						<col width="79"/>
						<col width="80"/>
						<col width="80"/>
						<col width="88"/>
					</columns>
					<head>
						<cell col="0" color="user12" display="text"/>
						<cell col="1" color="user12" colspan="4" display="text"/>
						<cell col="5" color="user12" colspan="4" display="text"/>
						<cell col="9" color="user12" colspan="4" display="text"/>
						<cell col="0" color="user12" display="text" row="1" text="월"/>
						<cell col="1" color="user12" display="text" font="굴림,9,Bold" row="1" text="구분"/>
						<cell col="2" color="user12" display="text" font="굴림,9,Bold" row="1" text="금&#32;액"/>
						<cell col="3" color="user12" display="text" font="굴림,9,Bold" row="1" text="입금일자"/>
						<cell col="4" color="user12" display="text" font="굴림,9,Bold" row="1" text="영수일자"/>
						<cell col="5" color="user12" display="text" font="굴림,9,Bold" row="1" text="구분"/>
						<cell col="6" color="user12" display="text" font="굴림,9,Bold" row="1" text="금&#32;액"/>
						<cell col="7" color="user12" display="text" font="굴림,9,Bold" row="1" text="입금일자"/>
						<cell col="8" color="user12" display="text" font="굴림,9,Bold" row="1" text="영수일자"/>
						<cell col="9" color="user12" display="text" font="굴림,9,Bold" row="1" text="구분"/>
						<cell col="10" color="user12" display="text" font="굴림,9,Bold" row="1" text="금&#32;액"/>
						<cell col="11" color="user12" display="text" font="굴림,9,Bold" row="1" text="입금일자"/>
						<cell col="12" color="user12" display="text" font="굴림,9,Bold" row="1" text="영수일자"/>
					</head>
					<body>
						<cell align="center" celltype="head" col="0" colid="MM" color="user12" display="text" font="굴림,9,Bold"/>
						<cell align="center" col="1" colid="BB_CODE_NM" display="text"/>
						<cell align="right" col="2" colid="BB_USE_AMT" display="number"/>
						<cell align="center" col="3" colid="BB_MAPPING_DAY" display="text" Mask="####/##/##"/>
						<cell align="center" col="4" colid="BB_RECV_DAY" display="text" Mask="####/##/##"/>
						<cell align="center" col="5" colid="B_CODE_NM" display="text"/>
						<cell align="right" col="6" colid="B_USE_AMT" display="number"/>
						<cell align="center" col="7" colid="B_MAPPING_DAY" display="text" Mask="####/##/##"/>
						<cell align="center" col="8" colid="B_RECV_DAY" display="text" Mask="####/##/##"/>
						<cell align="center" col="9" colid="CODE_NM" display="text"/>
						<cell align="right" col="10" colid="USE_AMT" display="number"/>
						<cell align="center" col="11" colid="MAPPING_DAY" display="text" Mask="####/##/##"/>
						<cell align="center" col="12" colid="RECV_DAY" display="text" Mask="####/##/##"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Image Height="17" Id="Image1" ImageID="C_icon2" Left="24" TabOrder="25" Top="490" Width="18"></Image>
		<Static Color="user1" Height="11" Id="sta_upso" Left="48" Style="tx_bold" TabOrder="24" Text="업소원장" Top="493" Width="400"></Static>
		<Edit Align="CENTER" BKColor="user8" Border="Flat" BorderColor="GRAYTEXT" Color="user12" Font="굴림,9,Bold" Height="24" Id="edt_year1" Left="47" OnChanged="Edit6_OnChanged" Readonly="TRUE" TabOrder="27" TabStop="FALSE" Top="510" Width="326"></Edit>
		<Edit Align="CENTER" BKColor="user8" Border="Flat" BorderColor="GRAYTEXT" Color="user12" Font="굴림,9,Bold" Height="24" Id="edt_year2" Left="371" Readonly="TRUE" TabOrder="26" TabStop="FALSE" Top="510" Width="325"></Edit>
		<Edit Align="CENTER" BKColor="user8" Border="Flat" BorderColor="GRAYTEXT" Color="user12" Font="굴림,9,Bold" Height="24" Id="edt_year3" Left="695" OnChanged="Edit3_OnChanged" Readonly="TRUE" TabOrder="28" TabStop="FALSE" Top="510" Width="328"></Edit>
	</Form>
	<Script><![CDATA[
#include "script::common.js"  	// 공통 js
#include "script::global.js"  	// 공통 js
#include "script::commonGibu.js"

#include "script::commonInsa.js"  // 공통 인사js
#include "script::commDs.js"


function form_OnLoadCompleted(obj)
{
	gfn_LoadForm(obj);
	gfn_GetDataGIBU_CD(this.cob_BRAN_CD, 1);
	
	gfn_SetPermission(this.cob_BRAN_CD.Value);
	
	// 초기설정
	var curYMD = today();
	//cal_SDay.Value = substr(curYMD, 0, 6) + "01" ;  // 현재월의 첫날 부터
	cal_SDay.Value = curYMD ;  // 현재월의 첫날 부터
	//cal_EDay.Value = curYMD;						// 현재일자 까지
	
	fn_year_Setting();
}


function fn_CommmonButtonClick(strCode){

    //신규
    if(strCode == "NEW"){}
    //조회
    else if(strCode == "SEARCH"){
		fn_Search();
    }
    //저장
    else if(strCode == "SAVE"){}
    //삭제
    else if(strCode == "DELETE"){}
    //Excel
    else if(strCode == "EXCEL"){
		fn_excel();
    }
    //출력
    else if(strCode == "PRINT"){}
    //닫기
    else if(strCode == "CLOSE"){
        close();
    }

	return;
}

function fn_CallBack(srvId,ErrorCode,ErrorMsg)
{
	
	if(ErrorCode < 0) {
		//에러 공통 팝업
		gfn_SetErrorPop(ErrorCode,ErrorMsg);
	}
}

function fn_Search() 
{
	//this.ds_save.ClearData();
	
	// 입력 필수 항목 검사;
	if (!gfn_CheckFormNull(this)) return;
	this.ds_search.SetColumn(0,"BRAN_CD",    this.cob_BRAN_CD.Value);
	this.ds_search.SetColumn(0,"UPSO_CD",    this.edt_UPSO_CD.Text);
	this.ds_search.SetColumn(0,"START_DAY", this.cal_Sday.Value);
	//this.ds_search.SetColumn(0,"END_DAY",   this.cal_Eday.Value);
	this.ds_search.SetColumn(0,"STAFF_CD",   this.cob_Staff_Nm.Value);
	
	
	//trace(this.ds_search.SaveXML());
	gfn_syncCall("misu_select","KOMCA?SYSID=PATHFINDER&MENUID=1000001006001017&EVENTID=misu_select","S=ds_search","ds_list=SEL1","","fn_CallBack");
	//trace(this.ds_list.SaveXML());
	
}

function fn_excel() {
	this.grd_list.ExportExcelEx("미수금장부");
}

function btn_FindUpso_OnClick(obj)
{

	if (length(this.cob_BRAN_CD.Value) == 0) {
        gfn_Confirm("MB_OK", "지부를 선택해주세요.", "경고", "0");
		this.cob_BRAN_CD.SetFocus();
		return;
	}
	
	fn_FindUPSO();
	
}

function fn_FindUPSO()
{
	//업소코드 입력 조회시 바로 조회창 페이지를 거치지 않고 바로 검색
	if(this.cob_BRAN_CD.Value==null){
	
        gfn_Confirm("MB_OK", "지부를 선택해주세요.", "경고", "0");
		this.cob_BRAN_CD.SetFocus();
		return false;
	}

	this.edt_UPSO_NM.SetFocus();
	var BRAN_CD = this.cob_BRAN_CD.Value;
	var UPSO_CD = this.edt_UPSO_CD.Text;
	var UPSO_NM = this.edt_UPSO_NM.Text;
    var inParam = "SGBN=bra05_s01" + " BRAN_CD=" + quote(BRAN_CD) + " UPSO_CD=" + quote(UPSO_CD) + " UPSO_NM=" + quote(UPSO_NM) + " SGBN=" + quote("bra01_s01");
	var result = Dialog("fi_bra::find_upso.xml",inParam);

	if(0 < length(result)){
	    var vArr = result.split(",");
	    this.edt_UPSO_CD.Text = vArr[0];
	    this.edt_UPSO_CD_1.Text = vArr[0];    
	    this.edt_UPSO_NM.Text = vArr[1];
	    this.edt_UPSO_NM_1.Text = vArr[1];    
	    
	}
	fn_search();
}


function edt_UPSO_CD_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(this.cob_BRAN_CD.Value==null){
	
        gfn_Confirm("MB_OK", "지부를 선택해주세요.", "경고", "0");
		this.cob_BRAN_CD.SetFocus();
		return false;
	}

	if (nChar == "13") {
		fn_GetUPSO_CD_cd();
	
	}
	else if (nChar == "112") fn_FindUPSO();

}

function fn_GetUPSO_CD()
{

	var BRAN_CD = this.cob_BRAN_CD.Value;
	var UPSO_CD = this.edt_UPSO_CD.Text;
	var UPSO_NM = this.edt_UPSO_NM.Text;

	var result = gfn_GetUPSO_CD(BRAN_CD, UPSO_CD, UPSO_NM);

	if (length(result) > 0) {
		var vArr = result.split(",");
		this.edt_UPSO_CD.Text = vArr[0];
		this.edt_UPSO_NM.Text = vArr[1];
		fn_search();
	}
	else {

		fn_FindUPSO();

	}
	this.edt_UPSO_NM.Text = this.edt_UPSO_NM_1.Text ;
}













function edt_UPSO_NM_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(cob_BRAN_CD.Text.Length() ==0 ) 
	{
        gfn_Confirm("MB_OK", "지부를 선택해주세요.", "경고", "0");
		cob_BRAN_CD.SetFocus();
		return;
	}
	if (nChar == "112") {
		fn_FindUPSO();
	}

	return;
}

function fn_GetUPSO_CD_cd()
{
	if(this.edt_UPSO_NM.Text == ""){
		var BRAN_CD = this.cob_BRAN_CD.Value;
		var UPSO_CD = this.edt_UPSO_CD.Text;
		var UPSO_NM = this.edt_UPSO_NM.Text;
		var result = gfn_GetUPSO_CD(BRAN_CD, UPSO_CD, UPSO_NM);
	
		if (length(result) > 0) {
			var vArr = result.split(",");
			this.edt_UPSO_CD.Text = vArr[0];
			this.edt_UPSO_NM.Text = vArr[1];
			fn_search();
		}
		else {
	
			fn_FindUPSO();
		}
	}
	else {

		var BRAN_CD = this.cob_BRAN_CD.Value;
		var UPSO_CD = this.edt_UPSO_CD.Text;
		var UPSO_NM = "";
		var result = gfn_GetUPSO_CD(BRAN_CD, UPSO_CD, UPSO_NM);
	
		if (length(result) > 0) {
			var vArr = result.split(",");
			this.edt_UPSO_CD.Text = vArr[0];
			this.edt_UPSO_NM.Text = vArr[1];
			fn_search();
		}
		else {
	
			fn_FindUPSO();
		}
	
	}
}
function edt_UPSO_CD_OnChar(obj,strPreText,nChar,strPostText,LLParam,HLParam)
{
	var strtext = right(strPostText,1);
	var chkstr = "[<!#$%*&_:=|`~'"+Quote("")+";@^+\\>-]"; 
	
	if(pos(chkstr, strtext) >= 0)   // 특수문자 사용 제한
	{
		return false;
	}
	
	if (length(strPostText) == 8 && nChar >= asc('a') && nChar <= asc('z')) {
		obj.Text = strPreText + toUpper(chr(nChar));
		return false;
	}
}


function cob_BRAN_CD_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{	
	gfn_SetPermission(strCode);
	//사번콤보 적용
	ds_bran_cd.SetColumn(0,"BRAN_CD", this.cob_BRAN_CD.Value );
	gfn_syncCall("SAWON_CLICK","KOMCA?SYSID=PATHFINDER&MENUID=1000001006007&EVENTID=p_staff_select","S=ds_bran_cd","ds_sawon=SEL1","","fn_CallBack");

	var iRow = ds_sawon.InsertRow(0);
	ds_sawon.SetColumn(iRow,"CODE_CD","");
	ds_sawon.SetColumn(iRow,"CODE_NM","");

	this.cob_Staff_Nm.Value = "";
	
	
}

function grd_list_OnCellPosChanged(obj,nRow,nCell,nOldRow,nOldCell,nPivotIndex,nOldPivotIndex)
{

	sta_upso.text = ds_list.GetColumn(nRow,"UPSO_CD") + "  " + ds_list.GetColumn(nRow,"UPSO_NM") + "  업소의 원장";
	this.ds_search2.ClearData();
	this.ds_search2.AddRow();
	ds_search2.SetColumn(0, "UPSO_CD", ds_list.GetColumn(nRow,"UPSO_CD"));
	ds_search2.SetColumn(0, "YEAR",    substr(today(), 0, 4));
	
	gfn_syncCall("wonjang_select","KOMCA?SYSID=PATHFINDER&MENUID=1000001006001017&EVENTID=wonjang_select","S=ds_search2","ds_wonjang=SEL1","","fn_CallBack");
}


function fn_year_Setting(){
	this.edt_year3.Text = substr(today(),0,4);
	this.edt_year2.Text = toNumber(substr(today(),0,4))-1;
	this.edt_year1.Text = toNumber(substr(today(),0,4))-2;
}]]></Script>
</Window>