<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="844" Id="form" Left="8" OnLoadCompleted="form_OnLoadCompleted" PidAttrib="7" Title="사용계약해지통보출력(센터)" Top="8" Ver="1.0" Width="1048" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Editable="True" Id="ds_upso" OnColumnChanged="ds_upso_OnColumnChanged" OnRowPosChanged="ds_upso_OnRowPosChanged" UseClientLayout="1">
				<Contents>
					<colinfo id="UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="INP_YRMN" size="256" summ="default" type="STRING"/>
					<colinfo id="CONTR_TERM_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="DAEPYO" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_ZIP" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_TEL" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_FAX" size="256" summ="default" type="STRING"/>
					<colinfo id="DISP_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAD_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="CHECK" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_upso_condi">
				<Contents>
					<colinfo id="BRAN_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="YRMN" size="256" summ="default" type="STRING"/>
					<colinfo id="INP_YRMN" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_CD" size="256" summ="default" type="STRING"/>
					<record>
						<BRAN_CD></BRAN_CD>
						<INP_YRMN></INP_YRMN>
						<UPSO_CD></UPSO_CD>
						<YRMN></YRMN>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Editable="True" Id="ds_upso_print" UseClientLayout="1">
				<Contents>
					<colinfo id="UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="INP_YRMN" size="256" summ="default" type="STRING"/>
					<colinfo id="CONTR_TERM_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="DAEPYO" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_ZIP" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_TEL" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_FAX" size="256" summ="default" type="STRING"/>
					<colinfo id="DISP_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAD_DAY" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Editable="True" Id="ds_upso_ins" UseClientLayout="1">
				<Contents>
					<colinfo id="UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="INP_YRMN" size="256" summ="default" type="STRING"/>
					<colinfo id="CONTR_TERM_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="DAEPYO" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_ZIP" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_TEL" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_FAX" size="256" summ="default" type="STRING"/>
					<colinfo id="DISP_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAD_DAY" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_upso_m">
				<Contents>
					<colinfo id="UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="INP_YRMN" size="256" summ="default" type="STRING"/>
					<colinfo id="CONTR_TERM_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="DISP_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="CHECK" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Grid BindDataset="ds_upso" BkColor2="user11" BkSelColor="user9" BoldHead="true" Border="Flat" Bottom="794" Editable="TRUE" Enable="true" EndLineColor="default" Face3dColor="user8" HeadHeight="23" Height="730" Id="grd_List" InputPanel="FALSE" Left="8" LineColor="silver" OnCellClick="grd_List_OnCellClick" OnExpandEdit="grd_List_OnExpandEdit" Right="1039" RowHeight="20" Style="grid" TabOrder="11" TabStop="FALSE" Top="64" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1031">
			<contents>
				<format id="Default">
					<columns>
						<col width="112"/>
						<col width="220"/>
						<col width="107"/>
						<col width="106"/>
						<col width="148"/>
						<col width="80"/>
					</columns>
					<head>
						<cell col="0" color="user12" display="text" text="업소코드"/>
						<cell col="1" color="user12" display="text" text="업소명"/>
						<cell col="2" color="user12" display="text" text="계약해지일"/>
						<cell col="3" color="user12" display="text" text="발송일"/>
						<cell col="4" color="user12" display="text" text="업주"/>
						<cell col="5" color="user12" display="text" text="출력"/>
					</head>
					<body>
						<cell align="center" bkcolor="user13" col="0" colid="UPSO_CD" display="text" edit='expr:iif(getrowtype(currow)&#32;==&#32;&quot;insert&quot;,&quot;normal&quot;,&quot;none&quot;)' expandimage="rbt_search01" expandshow='expr:iif(getrowtype(currow)&#32;==&#32;&quot;insert&quot;,true,false)'/>
						<cell col="1" colid="UPSO_NM" display="text"/>
						<cell col="2" colid="CONTR_TERM_DAY" display="date"/>
						<cell col="3" colid="DISP_DAY" display="date"/>
						<cell col="4" colid="DAEPYO" display="text"/>
						<cell col="5" colid="CHECK" display="checkbox" edit="checkbox"/>
					</body>
				</format>
			</contents>
		</Grid>
		<ubiviewer Bottom="776" Height="632" Id="ubi0" Left="8" Right="1048" Top="144" Visible="FALSE" Width="1040">
			<_PersistData>&#13;&#10;/6x39Y47/wAAAQB9awAAd1JBAPjy//7//fL4/PcMDwACBVQAWQBfUABFADD48QH+8C8DMQAyLwABNQH99S8CXgBuSQR0+vn+8C8L&#13;&#10;MgA1agAsOwBrCQRlD28FAfv0mAb+8q4ENAL/B0QAZQBmAGEPAHUAbFcD+PeYAvjwewhA+/MFUwBovQABZVcBAgM=&#13;&#10;</_PersistData>
		</ubiviewer>
		<Image FillType="STRETCH" Height="41" Id="Image15" ImageID="C_search_bg" Left="16" TabOrder="4" TabStop="FALSE" Top="12" Width="1012"></Image>
		<Image Height="41" Id="Image17" ImageID="C_search_left" Left="8" TabOrder="5" TabStop="FALSE" Top="12" Width="10"></Image>
		<Image Height="41" Id="Image18" ImageID="C_search_right" Left="1028" TabOrder="6" TabStop="FALSE" Top="12" Width="11"></Image>
		<Static Height="15" Id="Static0" Left="348" Style="tx_left_bold" TabOrder="8" Text="입력년월" Top="28" Width="50"></Static>
		<Image Height="11" Id="Image0" ImageID="C_icon" Left="332" TabOrder="7" TabStop="FALSE" Top="28" Width="11"></Image>
		<Static Height="15" Id="Static2" Left="588" Style="tx_left_bold" TabOrder="10" Text="발송일자" Top="28" Width="55"></Static>
		<Image Height="11" Id="Image1" ImageID="C_icon" Left="572" TabOrder="8" TabStop="FALSE" Top="28" Width="11"></Image>
		<Image Height="11" Id="Image2" ImageID="C_icon" Left="29" TabOrder="9" TabStop="FALSE" Top="28" Width="11"></Image>
		<Static Height="15" Id="Static1" Left="44" Style="tx_left_bold" TabOrder="12" Text="센터명" Top="28" Width="40"></Static>
		<Combo BKColor="user13" Height="18" Id="cob_BRAN_CD" Left="104" OnChanged="cob_BRAN_CD_OnChanged" TabOrder="1" ToolTipText="센터명" Top="24" Width="109"></Combo>
		<Calendar AutoIncrement="1" BKColor="user13" Dateformat="yyyy/MM" FocusIndex="1" Height="20" Id="cal_YRMN" Left="418" LeftMargin="15" OnKillFocus="cal_YRMN_OnKillFocus" SaturdayTextColor="blue" SpinStyle="1" SundayTextColor="red" TabOrder="2" ToolTipText="입력년월" Top="23" Width="102"></Calendar>
		<Calendar Dateformat="yyyy/MM/dd" Height="20" Id="cal_disp_day" Left="664" LeftMargin="4" MonthPickerFormat="yyyy년&#32;MM월" SaturdayTextColor="blue" SundayTextColor="red" TabOrder="3" Top="23" Width="96"></Calendar>
		<Button Appearance="FLAT" BKColor="user8" BorderColor="silver" Color="user12" Font="굴림,9,Bold" Height="24" Id="btn_pnt" Left="701" OnClick="btn_pnt_OnClick" TabOrder="10" TabStop="FALSE" Text="출력" Top="64" Width="81"></Button>
	</Form>
	<Script><![CDATA[#include "script::common.js"  		// 공통 js
#include "script::commonGibu.js"  	// 센터 공통 js

var btn_print;		//출력을 클릭시에 전체 선책인지 전체 해지인지 확인

function form_OnLoadCompleted(obj)
{
	//Ubi0.setJrfFileDir("http://192.168.1.192:8080/report_file/fi/bra/");
	//Ubi0.setJrfFileName("w_gibu803.jrf");
	//Ubi0.setJrfFileName("bra08_p03.jrf");
	//Ubi0.Retrieve();
	gfn_LoadForm(obj);
		
		// 센터코드 가져오기
	gfn_GetDataGIBU_CD(this.cob_BRAN_CD, 1);
	this.cal_disp_day = substr(getdate(),0,8);
	this.cal_YRMN = substr(getdate(),0,8);
	
	this.ds_upso_condi.AddRow();
	gfn_SetPermission(this.cob_BRAN_CD.Value);
}



function fn_CommmonButtonClick(strCode){

    //신규
    if(strCode == "NEW"){
		fn_New();
    }
    //조회
    else if(strCode == "SEARCH"){
		fn_Search();
    }
    //저장
    else if(strCode == "SAVE"){
		fn_Save();
    }
    //삭제
    else if(strCode == "DELETE"){
		fn_Delete();
    }
    //Excel
    else if(strCode == "EXCEL"){
		fn_Excel();
    }
    //출력
    else if(strCode == "PRINT"){
		fn_Print();
    }
    //닫기
   
    else if(strCode == "CLOSE"){
        close();
    }
    

	return;
}



function fn_Print(){


// 입력 필수 항목 검사;
	if (!gfn_CheckFormNull(this)) return;

	if(length(trim(this.edt_doc_no.Text)) ==0)
	{
        gfn_Confirm("MB_OK", "문서번호를 입력하세요.", "경고", "0");
		this.edt_doc_no.SetFocus();
		return;
	}

	this.ds_upso_print.ClearData();
	var idx=0;
	for(var i=0;i<this.ds_upso.rowcount;i++){
		if(this.ds_upso.GetColumn(i,"CHECK") == "1") 
		{
			if(this.ds_upso.GetColumn(i,"UPSO_CD")==null or this.ds_upso.GetColumn(i,"UPSO_CD")==""){
				gfn_Confirm("MB_OK", "데이터가 없는 값이 출력선택되었습니다. 데이터를 입력 후 출력해 주세요", "경고", "0");
				return;
			}
			idx = this.ds_upso_print.AddRow();
			this.ds_upso_print.SetColumn(idx, "UPSO_CD", this.ds_upso.GetColumn(i,"UPSO_CD"));
			this.ds_upso_print.SetColumn(idx, "UPSO_NM", this.ds_upso.GetColumn(i,"UPSO_NM"));
			this.ds_upso_print.SetColumn(idx, "BRAN_CD", this.ds_upso.GetColumn(i,"BRAN_CD"));
			this.ds_upso_print.SetColumn(idx, "BRAN_NM", this.ds_upso.GetColumn(i,"BRAN_NM"));
			this.ds_upso_print.SetColumn(idx, "INP_YRMN", this.ds_upso.GetColumn(i,"INP_YRMN"));
			this.ds_upso_print.SetColumn(idx, "BRAN_ZIP", this.ds_upso.GetColumn(i,"BRAN_ZIP"));
			this.ds_upso_print.SetColumn(idx, "BRAN_ADDR", this.ds_upso.GetColumn(i,"BRAN_ADDR"));
			this.ds_upso_print.SetColumn(idx, "BRAN_TEL", this.ds_upso.GetColumn(i,"BRAN_TEL"));
			this.ds_upso_print.SetColumn(idx, "BRAN_FAX", this.ds_upso.GetColumn(i,"BRAN_FAX"));
			
			this.ds_upso_print.SetColumn(idx, "ZIP", this.ds_upso.GetColumn(i,"ZIP"));
			this.ds_upso_print.SetColumn(idx, "ADDR",     this.ds_upso.GetColumn(i,"ADDR"));
			
			this.ds_upso_print.SetColumn(idx, "DAEPYO",     this.ds_upso.GetColumn(i,"DAEPYO"));
			this.ds_upso_print.SetColumn(idx, "CONTR_TERM_DAY",     this.ds_upso.GetColumn(i,"CONTR_TERM_DAY"));
			this.ds_upso_print.SetColumn(idx, "DISP_DAY",     this.ds_upso.GetColumn(i,"DISP_DAY"));
			this.ds_upso_print.SetColumn(idx, "DAEPYO",     this.ds_upso.GetColumn(i,"DAEPYO"));
			
			this.ds_upso_print.SetColumn(idx, "DEAD_DAY", adddate( this.ds_upso.GetColumn(i,"DISP_DAY") , 7) );		
				
	//=========================================================================================================================>	
	// 프로세스빌더에 핑요한 컬럼만 보낸다.
			
				
				
		}
	}

	if(ds_upso_print.rowcount > 0) {
		//ubi0.setFileURL("D:/PROJECT관리/음저협/rpt/");
		//ubi0.setJrfFileDir("D:/PROJECT관리/음저협/rpt/");
		ubi0.setJrfFileDir(gv_ReportUrl+"fi/bra/");
		ubi0.setJrfFileName("bra08_s04.jrf");
		ubi0.SetArgument("disp_day", this.cal_disp_day.Value);
		
		ubi0.SetDataset("ds_upso", "ds_upso_print");
		ubi0.Retrieve();
		ubi0.directPrint();
		for(var i=0; i<this.ds_upso.rowcount; i++)	
		{
			this.ds_upso_m.AddRow();
			this.ds_upso_m.SetColumn(i, "UPSO_CD", this.ds_upso.GetColumn(i,"UPSO_CD"));
			this.ds_upso_m.SetColumn(i, "INP_YRMN", this.ds_upso.GetColumn(i,"INP_YRMN"));
			this.ds_upso_m.SetColumn(i, "CONTR_TERM_DAY", this.ds_upso.GetColumn(i,"CONTR_TERM_DAY"));
			this.ds_upso_m.SetColumn(i, "DISP_DAY", this.ds_upso.GetColumn(i,"DISP_DAY"));
			this.ds_upso_m.SetColumn(i, "CHECK", this.ds_upso.GetColumn(i,"CHECK"));
		}
		
		
	//trace(this.ds_upso_m.SaveXML());
		gfn_syncCall("UPSO_REPT","KOMCA?SYSID=PATHFINDER&MENUID=1000001006011004&EVENTID=contr_term_mng","S=ds_upso_m:U","","","fn_CallBack", gv_TraceLog, gv_formid);	
	//trace(this.ds_upso_m.SaveXML());
	ds_upso_m.ClearData();

	}else {
        gfn_Confirm("MB_OK", "출력 대상이 없습니다.", "경고", "0");
		return;
	}


}

function fn_save(){

// 입력 필수 항목 검사;
	if (!gfn_CheckFormNull(this)) return;
	gfn_syncCall("UPSO_REPT","KOMCA?SYSID=PATHFINDER&MENUID=1000001006011004&EVENTID=contr_term_mng","S=ds_upso","","","fn_CallBack");

}


function fn_Delete(){
	
	if(ds_upso.getRowType(ds_upso.currow) == "insert")
	{
		ds_upso.DeleteRow(ds_upso.currow);
	}else {
		this.ds_upso_condi.SetColumn(0,"UPSO_CD" , ds_upso.GetColumn(ds_upso.currow,"UPSO_CD"));
		this.ds_upso_condi.SetColumn(0,"INP_YRMN", ds_upso.GetColumn(ds_upso.currow,"INP_YRMN"));
		
		gfn_syncCall("UPSO_DEL","KOMCA?SYSID=PATHFINDER&MENUID=1000001006011004&EVENTID=contr_term_delete","S=ds_upso_condi:N","","","fn_CallBack", gv_TraceLog, gv_formid);
		ds_upso.DeleteRow(ds_upso.currow);
	}
}

function fn_New() {

	if(this.cob_BRAN_CD.Value == "" or this.cob_BRAN_CD.Value == null){
        gfn_Confirm("MB_OK", "센터를 선택해주세요.", "경고", "0");
		return;
	}
	var rowindex = ds_upso.AddRow();
	this.ds_upso.SetColumn(rowindex,"DISP_DAY", this.cal_disp_day.Value);
	var datex = AddDate(this.cal_disp_day.Value, 10);
	this.ds_upso.SetColumn(rowindex,"CONTR_TERM_DAY",  datex);
}

function fn_isFindedUpdateRow()
{
	for ( var i = 0 ; i < dsObj.rowcount ; i++ )
	{
		if ( ds_upso.getRowType(i) == "insert" ) 
			return 1 ;
		else if ( ds_upso.getRowType(i) == "update" )
			return 1 ;
	}
}

function fn_Search() 
{
// 입력 필수 항목 검사;
	if (!gfn_CheckFormNull(this)) return;
	if(fn_isFindedUpdateRow() == 1) 
	{
		if(Confirm("변경 data가 존재 합니다. 저장하시겠습니까?"))
		{
			fn_save();
		}
	}
	this.ds_upso_condi.SetColumn(0,"BRAN_CD" ,this.cob_BRAN_CD.Value  );
	this.ds_upso_condi.SetColumn(0,"YRMN"    ,substr(this.cal_YRMN.Value,0,6));
	//trace(ds_upso_condi.SaveXML());
	gfn_syncCall("UPSO_REPT","KOMCA?SYSID=PATHFINDER&MENUID=1000001006011004&EVENTID=contr_term_list","S=ds_upso_condi","ds_upso=SEL1","","fn_CallBack");
	//trace(this.ds_upso.SaveXML());
}

function fn_Excel() {}

function fn_CallBack(srvId,ErrorCode,ErrorMsg)
{
	
	if(ErrorCode < 0) {
		//에러 공통 팝업
		gfn_SetErrorPop(ErrorCode,ErrorMsg);
	}
}


function fn_SetGridUPSO_CD(result, nRow)
{
	var vArr = result.split(",");

	this.ds_upso.SetColumn(nRow,"UPSO_CD",vArr[0]);
	this.ds_upso.SetColumn(nRow,"UPSO_NM",vArr[1]);

	if(gfn_CheckDupDs2(ds_upso,"UPSO_CD") > 0) 
	{
		gfn_Confirm("MB_OK", "이미 등록되어 있습니다.", "경고", "0");
		this.ds_upso.SetColumn(nRow,"UPSO_CD","");
		this.ds_upso.SetColumn(nRow,"UPSO_NM","");
		
		this.ds_upso.DeleteRow(this.ds_upso.lastrow);
		fn_new();
		return;
		
	}

	this.ds_upso_condi.SetColumn(0,"BRAN_CD",this.cob_BRAN_CD.Value);
	this.ds_upso_condi.SetColumn(0,"UPSO_CD",this.ds_upso.GetColumn(nRow,"UPSO_CD") );	

	gfn_syncCall("UPSO_REPT","KOMCA?SYSID=PATHFINDER&MENUID=1000001006011004&EVENTID=contr_term_add","S=ds_upso_condi","ds_upso_ins=SEL1","","fn_CallBack");
	
	this.ds_upso.SetColumn(nRow,"BRAN_CD",this.cob_BRAN_CD.Value);
	this.ds_upso.SetColumn(nRow,"BRAN_NM",this.cob_BRAN_CD.Text);
	this.ds_upso.SetColumn(nRow,"DAEPYO",ds_upso_ins.GetColumn(0,"DAEPYO"));
	this.ds_upso.SetColumn(nRow,"BRAN_ZIP",ds_upso_ins.GetColumn(0,"BRAN_ZIP"));
	this.ds_upso.SetColumn(nRow,"BRAN_ADDR",ds_upso_ins.GetColumn(0,"BRAN_ADDR"));
	this.ds_upso.SetColumn(nRow,"BRAN_TEL",ds_upso_ins.GetColumn(0,"BRAN_TEL"));
	this.ds_upso.SetColumn(nRow,"BRAN_FAX",ds_upso_ins.GetColumn(0,"BRAN_FAX"));
	this.ds_upso.SetColumn(nRow,"ZIP",ds_upso_ins.GetColumn(0,"ZIP"));
	this.ds_upso.SetColumn(nRow,"ADDR",ds_upso_ins.GetColumn(0,"ADDR"));

	this.ds_upso.SetColumn(nRow,"INP_YRMN", substr(this.cal_YRMN.Value,0,6)  );
}

function SetUpsoInfos(UPSO_CD, UPSO_NM)
{
	this.ds_upso.SetColumn(this.ds_upso.lastrow , "UPSO_CD", UPSO_CD);
	this.ds_upso.SetColumn(this.ds_upso.lastrow , "UPSO_NM", UPSO_NM);
	var nRow = this.ds_upso.lastrow;
	if(gfn_CheckDupDs2(ds_upso,"UPSO_CD") > 0) 
	{
		gfn_Confirm("MB_OK", "이미 등록되어 있습니다.", "경고", "0");
		this.ds_upso.SetColumn(nRow,"UPSO_CD","");
		this.ds_upso.SetColumn(nRow,"UPSO_NM","");
		return;
	}

	this.ds_upso_condi.SetColumn(0,"BRAN_CD",this.cob_BRAN_CD.Value);
	this.ds_upso_condi.SetColumn(0,"UPSO_CD",this.ds_upso.GetColumn(nRow,"UPSO_CD") );	

	gfn_syncCall("UPSO_REPT","KOMCA?SYSID=PATHFINDER&MENUID=1000001006011004&EVENTID=contr_term_add","S=ds_upso_condi","ds_upso_ins=SEL1","","fn_CallBack");
	
	this.ds_upso.SetColumn(,"BRAN_CD",this.cob_BRAN_CD.Value);
	this.ds_upso.SetColumn(nRow,"BRAN_NM",this.cob_BRAN_CD.Text);
	this.ds_upso.SetColumn(nRow,"DAEPYO",ds_upso_ins.GetColumn(0,"DAEPYO"));
	this.ds_upso.SetColumn(nRow,"BRAN_ZIP",ds_upso_ins.GetColumn(0,"BRAN_ZIP"));
	this.ds_upso.SetColumn(nRow,"BRAN_ADDR",ds_upso_ins.GetColumn(0,"BRAN_ADDR"));
	this.ds_upso.SetColumn(nRow,"BRAN_TEL",ds_upso_ins.GetColumn(0,"BRAN_TEL"));
	this.ds_upso.SetColumn(nRow,"BRAN_FAX",ds_upso_ins.GetColumn(0,"BRAN_FAX"));
	this.ds_upso.SetColumn(nRow,"ZIP",ds_upso_ins.GetColumn(0,"ZIP"));
	this.ds_upso.SetColumn(nRow,"ADDR",ds_upso_ins.GetColumn(0,"ADDR"));

	this.ds_upso.SetColumn(nRow,"INP_YRMN", substr(this.cal_YRMN.Value,0,6)  );		
}

function cob_BRAN_CD_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	gfn_SetPermission(strCode);
	this.ds_upso.ClearData();
}


function cal_YRMN_OnKillFocus(obj)
{
/*
	if(this.cob_BRAN_CD.Value.Length() != 0)
	{
		fn_Search();
	}
	*/
}

function ds_upso_OnRowPosChanged(obj,nOldRow,nRow)
{
	if( length(ds_upso.GetColumn(nOldRow,"UPSO_CD")) ==0 )
	{
		ds_upso.DeleteRow(nOldRow);
	}
}


function btn_pnt_OnClick(obj)
{
	var i=0;
	for(i=0; i<ds_upso.RowCount(); i++){
		if(btn_print==1){
			this.ds_upso.SetColumn(i,"CHECK",0);
		}
		else this.ds_upso.SetColumn(i,"CHECK",1);
	}
	if(btn_print ==0) btn_print =1;
	else btn_print = 0;
}

function grd_List_OnExpandEdit(obj,nRow,nCell,strVal,nPivotIndex)
{
	if(this.cal_YRMN.Value.Length() ==0 ) 
	{
        gfn_Confirm("MB_OK", "입력년월을 입력을 설정하십시오.", "경고", "0");
		return;
	}

	if (nCell == 0) 
	{
		if(this.cob_BRAN_CD.Index < 0) 
		{
			gfn_Confirm("MB_OK", "센터를 선택하십시요", "경고", "0");
			this.cob_BRAN_CD.SetFocus();
			return;
		}
	
		var BRAN_CD = this.cob_BRAN_CD.Value;
		var UPSO_CD = "";
		var upso_NM = "";
		
		var inParam =" BRAN_CD=" + quote(BRAN_CD) + " UPSO_CD=" + quote(UPSO_CD) + " UPSO_NM=" + quote(UPSO_NM) + " SGBN=" + quote("bra08_s04");
		var result = Dialog("fi_bra::find_upso.xml", inParam);

		if(0 < length(result)){
			fn_SetGridUPSO_CD(result, nRow);
		}
	}
}

function ds_upso_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID == "UPSO_CD") {
		if (length(varNewValue) > 0) {
			var BRAN_CD = this.cob_BRAN_CD.Value;
			var result = gfn_GetUPSO_CD(BRAN_CD, varNewValue, "");
		
			if (length(result ) > 0) {
				fn_SetGridUPSO_CD(result, nRow);
			}
		}
	}
}
]]></Script>
</Window>