<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="840" Id="bra04_s22" Left="8" OnLoadCompleted="bra04_s22_OnLoadCompleted" OnSize="bra04_s22_OnSize" PidAttrib="7" Title="입금반환요청" Top="8" Ver="1.0" Width="1048" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_BRAN_CD">
				<Contents>
					<colinfo id="BRAN_CD" size="256" summ="default" type="STRING"/>
					<record>
						<BRAN_CD></BRAN_CD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_SawonInfo">
				<Contents>
					<colinfo id="STAFF_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="STAFF_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="ETCOM_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="ORDER_GBN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_Auth">
				<Contents>
					<colinfo id="DEPT_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DEPT_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="UDTKPRES_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="UDTKPRES_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="INSPRES_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="INSPRES_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="INS_DATE" size="256" summ="default" type="STRING"/>
					<colinfo id="MODPRES_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="MODPRES_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="MOD_DATE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_search">
				<Contents>
					<colinfo id="BRAN_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="STAFF_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="INS_START" size="256" summ="default" type="STRING"/>
					<colinfo id="INS_END" size="256" summ="default" type="STRING"/>
					<colinfo id="REPT_FROM" size="256" summ="default" type="STRING"/>
					<colinfo id="REPT_TO" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
					<record>
						<BRAN_CD></BRAN_CD>
						<GBN></GBN>
						<INS_END></INS_END>
						<INS_START></INS_START>
						<REPT_FROM></REPT_FROM>
						<REPT_TO></REPT_TO>
						<STAFF_CD></STAFF_CD>
						<UPSO_CD></UPSO_CD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_filetype">
				<Contents>
					<colinfo id="CODE_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NM" size="256" summ="default" type="STRING"/>
					<record>
						<CODE_CD>F1</CODE_CD>
						<CODE_NM>pdf</CODE_NM>
					</record>
					<record>
						<CODE_CD>F2</CODE_CD>
						<CODE_NM>excel</CODE_NM>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_gbn">
				<Contents>
					<colinfo id="CODE_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NM" size="256" summ="default" type="STRING"/>
					<record>
						<CODE_CD></CODE_CD>
						<CODE_NM>--전체--</CODE_NM>
					</record>
					<record>
						<CODE_CD>1</CODE_CD>
						<CODE_NM>등록</CODE_NM>
					</record>
					<record>
						<CODE_CD>2</CODE_CD>
						<CODE_NM>센터장확인</CODE_NM>
					</record>
					<record>
						<CODE_CD>3</CODE_CD>
						<CODE_NM>최종확인</CODE_NM>
					</record>
					<record>
						<CODE_CD>4</CODE_CD>
						<CODE_NM>반환완료</CODE_NM>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_rept_gbn">
				<Contents>
					<colinfo id="CODE_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NM" size="256" summ="default" type="STRING"/>
					<record>
						<CODE_CD></CODE_CD>
						<CODE_NM></CODE_NM>
					</record>
					<record>
						<CODE_CD></CODE_CD>
						<CODE_NM></CODE_NM>
					</record>
					<record>
						<CODE_CD></CODE_CD>
						<CODE_NM></CODE_NM>
					</record>
					<record>
						<CODE_CD></CODE_CD>
						<CODE_NM></CODE_NM>
					</record>
					<record>
						<CODE_CD></CODE_CD>
						<CODE_NM></CODE_NM>
					</record>
					<record>
						<CODE_CD></CODE_CD>
						<CODE_NM></CODE_NM>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_code_bank">
				<Contents>
					<colinfo id="BANK_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="BANK_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_result" OnColumnChanged="ds_result_OnColumnChanged" OnRowPosChanged="ds_result_OnRowPosChanged" UseClientLayout="1">
				<Contents>
					<colinfo id="BRAN_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="BRAN_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="STAFF_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="STAFF_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="INS_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="REPT_GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="REPT_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="REPT_BANK_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="REPT_ACCN_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="REPTPRES" size="256" summ="default" type="STRING"/>
					<colinfo id="REPT_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="REPT_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="COMIS" size="256" summ="default" type="STRING"/>
					<colinfo id="KOMCA_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="RETURN_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="RETURN_BANK_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="RETURN_ACCN_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="ACCOUNT_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="REAS" size="256" summ="default" type="STRING"/>
					<colinfo id="REAL_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="CONFIRM1_CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="CONFIRM_ID1" size="256" summ="default" type="STRING"/>
					<colinfo id="CONFIRM1_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="CONFIRM1_DATE" size="256" summ="default" type="STRING"/>
					<colinfo id="CONFIRM2_CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="CONFIRM_ID2" size="256" summ="default" type="STRING"/>
					<colinfo id="CONFIRM2_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="CONFIRM2_DATE" size="256" summ="default" type="STRING"/>
					<colinfo id="REMAK" size="256" summ="default" type="STRING"/>
					<colinfo id="RETURN_DAY" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_file" UseClientLayout="1">
				<Contents>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="FILE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="SVR_FILE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="SVR_FILE_ROUT" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="INS_DAY" size="256" summ="default" type="STRING"/>
					<colinfo id="CONFIRM_YN" size="256" summ="default" type="STRING"/>
					<colinfo id="REMAK" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_temp" UseClientLayout="1">
				<Contents>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="UPSO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="INS_DAY" size="256" summ="default" type="STRING"/>
					<record>
						<GBN></GBN>
						<INS_DAY></INS_DAY>
						<UPSO_CD></UPSO_CD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_rept_gbn_ref">
				<Contents>
					<colinfo id="CODE_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Image FillType="STRETCH" Height="80" Id="Image15" ImageID="C_Search2_bg1" Left="15" TabOrder="0" TabStop="FALSE" Top="9" Width="1018"></Image>
		<Image Height="80" Id="Image18" ImageID="C_search2_right1" Left="1027" TabOrder="0" TabStop="FALSE" Top="9" Width="11"></Image>
		<Image Height="11" Id="Image16" ImageID="C_icon" Left="25" TabOrder="1" TabStop="FALSE" Top="26" Width="12"></Image>
		<Static Height="15" Id="Static1" Left="45" Style="tx_left_bold" TabOrder="6" Text="센터명" Top="26" Width="40"></Static>
		<Image Height="80" Id="Image17" ImageID="C_Search2_left1" Left="7" TabOrder="7" TabStop="FALSE" Top="9" Width="10"></Image>
		<Combo BindDataset="ds_search" BKColor="user13" Border="Flat" BorderColor="user10" Column="BRAN_CD" Height="20" Id="cob_BRAN_CD" ImeMode="none" INDEX="1" Left="91" OnChanged="cob_BRAN_CD_OnChanged" TabOrder="0" ToolTipText="센터명" Top="20" Width="109"></Combo>
		<Image Height="11" Id="img_emp" ImageID="C_icon" Left="244" TabOrder="6" TabStop="FALSE" Top="26" Width="11"></Image>
		<Static Height="14" Id="st_emp" Left="264" Style="tx_left_bold" TabOrder="7" Text="담당자" Top="26" Width="40"></Static>
		<Combo BindDataset="ds_search" Border="Flat" BorderColor="user10" CodeColumn="STAFF_CD" Column="STAFF_CD" DataColumn="STAFF_NM" Height="20" Id="cob_Staff_Nm" ImeMode="none" INDEX="1" InnerDataset="ds_SawonInfo" Left="309" TabOrder="1" ToolTipText="담당" Top="20" Width="80"></Combo>
		<Image Height="11" Id="Image1" ImageID="C_icon" Left="25" TabOrder="8" TabStop="FALSE" Top="60" Width="11"></Image>
		<Static Height="15" Id="Static2" Left="45" Style="tx_left_bold" TabOrder="8" Text="등록일자" Top="60" Width="52"></Static>
		<Calendar BindDataset="ds_search" Border="Flat" BorderColor="user3" Column="INS_START" Dateformat="yyyy/MM/dd" DayStyle="edit" EditAlign="CENTER" Height="20" Id="cal_ins_start" Left="106" MonthPickerFormat="yyyy년&#32;MM월" OnChanged="cal_OnChanged" SaturdayTextColor="blue" SundayTextColor="red" TabOrder="2" Top="55" Width="91"></Calendar>
		<Calendar BindDataset="ds_search" Border="Flat" BorderColor="user3" Column="INS_END" Dateformat="yyyy/MM/dd" DayStyle="edit" EditAlign="CENTER" Height="20" Id="cal_ins_end" Left="208" MonthPickerFormat="yyyy년&#32;MM월" OnChanged="cal_OnChanged" SaturdayTextColor="blue" SundayTextColor="red" TabOrder="3" Top="56" Width="91"></Calendar>
		<Static Height="15" Id="Static19" Left="200" TabOrder="9" Text="~" Top="61" Width="8"></Static>
		<Shape BKColor="user7" Bottom="96" Height="3" Id="Shape0" Left="8" LineColor="user7" Right="1036" TabOrder="17" Top="93" Type="Rectangle" Width="1028"></Shape>
		<Image Height="11" Id="Image3" ImageID="C_icon" Left="329" TabOrder="18" TabStop="FALSE" Top="60" Width="11"></Image>
		<Static Height="15" Id="Static5" Left="349" Style="tx_left_bold" TabOrder="19" Text="최종확인일자" Top="60" Width="82"></Static>
		<Calendar BindDataset="ds_search" Border="Flat" BorderColor="user3" Column="REPT_FROM" Dateformat="yyyy/MM/dd" DayStyle="edit" EditAlign="CENTER" Height="20" Id="cal_rept_start" Left="440" MonthPickerFormat="yyyy년&#32;MM월" OnChanged="cal_OnChanged" SaturdayTextColor="blue" SundayTextColor="red" TabOrder="4" Top="55" Width="91"></Calendar>
		<Calendar BindDataset="ds_search" Border="Flat" BorderColor="user3" Column="REPT_TO" Dateformat="yyyy/MM/dd" DayStyle="edit" EditAlign="CENTER" Height="20" Id="cal_rept_end" Left="544" MonthPickerFormat="yyyy년&#32;MM월" OnChanged="cal_OnChanged" SaturdayTextColor="blue" SundayTextColor="red" TabOrder="5" Top="55" Width="91"></Calendar>
		<Static Height="15" Id="Static6" Left="534" TabOrder="20" Text="~" Top="61" Width="8"></Static>
		<Grid AreaSelect="true" AutoEnter="TRUE" BindDataset="ds_result" BkColor2="user11" BkSelColor="user9" BoldHead="true" Border="Flat" Bottom="636" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" Face3dColor="user8" FixedColSizing="TRUE" HeadHeight="32" Height="540" Id="grd_result" InputPanel="FALSE" Left="8" LineColor="silver" NoDataText="조회&#32;결과가&#32;없습니다." OnCellDBLClick="grd_result_OnCellDblClick" OnChar="grd_result_OnChar" OnEnterDown="grd_result_OnEnterDown" OnExpandEdit="grd_result_OnExpandEdit" OnKeyDown="grd_result_OnKeyDown" Right="1036" RightFixLine="TRUE" RowHeight="20" Style="grid" TabOrder="21" TabStop="true" Top="96" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1028">
			<contents>
				<format id="Default">
					<columns>
						<col fix="left" width="30"/>
						<col fix="left" width="90"/>
						<col fix="left" width="70"/>
						<col fix="left" width="70"/>
						<col fix="left" width="70"/>
						<col fix="left" width="90"/>
						<col width="70"/>
						<col width="70"/>
						<col width="70"/>
						<col width="120"/>
						<col width="80"/>
						<col width="58"/>
						<col width="70"/>
						<col width="70"/>
						<col width="80"/>
						<col width="70"/>
						<col width="70"/>
						<col width="120"/>
						<col width="80"/>
						<col width="120"/>
						<col width="24"/>
						<col width="70"/>
						<col width="70"/>
						<col width="24"/>
						<col width="70"/>
						<col width="70"/>
						<col width="110"/>
						<col width="80"/>
						<col width="70"/>
					</columns>
					<head>
						<cell col="0" color="user12" display="text" text="순번"/>
						<cell col="1" color="user12" display="text" text="센터"/>
						<cell col="2" color="user12" display="text" text="담당자"/>
						<cell col="3" color="user12" display="text" text="등록일자"/>
						<cell col="4" color="user12" display="text" text="업소코드"/>
						<cell col="5" color="user12" display="text" text="업소명"/>
						<cell col="6" color="user12" display="text" text="입금구분"/>
						<cell col="7" color="user12" display="text" text="입금일자"/>
						<cell col="8" color="user12" display="text" text="입금은행"/>
						<cell col="9" color="user12" display="text" text="입금계좌"/>
						<cell col="10" color="user12" display="text" text="입금자명"/>
						<cell col="11" color="user12" display="text" text="입금횟수"/>
						<cell col="12" color="user12" display="text" text="입금액&#10;(원장)"/>
						<cell col="13" color="user12" display="text" text="총수수료"/>
						<cell col="14" color="user12" display="text" text="정상입금액&#10;(협회사용료)"/>
						<cell col="15" color="user12" display="text" text="반환금액"/>
						<cell col="16" color="user12" display="text" text="반환은행"/>
						<cell col="17" color="user12" display="text" text="반환계좌"/>
						<cell col="18" color="user12" display="text" text="예금주"/>
						<cell col="19" color="user12" display="text" text="반환사유"/>
						<cell col="20" color="user12" colspan="3" display="text" text="센터장확인"/>
						<cell col="23" color="user12" colspan="3" display="text" text="담당자확인"/>
						<cell col="26" color="user12" display="text" text="반송사유"/>
						<cell col="27" color="user12" display="text" text="실제반환금액&#10;(전표)"/>
						<cell col="28" color="user12" display="text" text="반환일자"/>
					</head>
					<body>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="0" colid="SEQ" display="number" expr="currow+1"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;lemonchiffon&apos;)" col="1" colid="BRAN_NM" display="text"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;lemonchiffon&apos;)" col="2" colid="STAFF_NM" display="text"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;lemonchiffon&apos;)" col="3" colid="INS_DAY" display="date" Mask="yyyy-MM-dd"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;lemonchiffon&apos;)" col="4" colid="UPSO_CD" display="text" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;normal&apos;)" expandimage="rbt_search01" expandshow='expr:iif(getrowtype(currow)==&quot;insert&quot;,true,false)' imemode="english" limit="8"/>
						<cell align="left" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;lemonchiffon&apos;)" col="5" colid="UPSO_NM" display="text"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="6" colid="REPT_GBN" combocol="CODE_CD" combodataset="ds_rept_gbn" combodisplayrowcnt="10" combotext="CODE_NM" display="combo" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;combo&apos;)"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="7" colid="REPT_DAY" display="text" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;normal&apos;)"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="8" colid="REPT_BANK_CD" combocol="BANK_CD" combodataset="ds_code_bank" combodisplayrowcnt="10" combotext="BANK_NM" display="combo" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;combo&apos;)"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="9" colid="REPT_ACCN_NUM" display="text" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;normal&apos;)"/>
						<cell align="left" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="10" colid="REPTPRES" display="text" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;normal&apos;)"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="11" colid="REPT_CNT" display="number" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="12" colid="REPT_AMT" display="number" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="13" colid="COMIS" display="number" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="14" colid="KOMCA_AMT" display="number" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="15" colid="RETURN_AMT" display="number" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="16" colid="RETURN_BANK_CD" combocol="BANK_CD" combodataset="ds_code_bank" combotext="BANK_NM" display="combo" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;combo&apos;)"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="17" colid="RETURN_ACCN_NUM" display="text" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;normal&apos;)"/>
						<cell align="left" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="18" colid="ACCOUNT_NM" display="text" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;normal&apos;)"/>
						<cell align="left" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="19" colid="REAS" display="text" edit="expr:decode(CONFIRM1_CHK,&apos;1&apos;,&apos;none&apos;,&apos;normal&apos;)"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="20" colid="CONFIRM1_CHK" display="checkbox"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="21" colid="CONFIRM1_NM" display="text"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="22" colid="CONFIRM1_DATE" display="text" Mask="####-##-##"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="23" colid="CONFIRM2_CHK" display="checkbox"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="24" colid="CONFIRM2_NM" display="text"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="25" colid="CONFIRM2_DATE" display="text" Mask="####-##-##"/>
						<cell align="left" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="26" colid="REMAK" display="text" edit="normal"/>
						<cell align="right" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="27" colid="REAL_AMT" display="number"/>
						<cell align="center" bkcolor="expr:iif(length(RETURN_DAY)&#32;&gt;&#32;0&#32;,&#32;&apos;pink&apos;,&apos;&apos;)" col="28" colid="RETURN_DAY" display="date" Mask="yyyy-MM-dd"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Image Height="11" Id="Image4" ImageID="C_icon" Left="825" TabOrder="22" TabStop="FALSE" Top="26" Width="11"></Image>
		<Static Color="user12" Height="11" Id="Static0" Left="841" Style="tx_left_bold" TabOrder="23" Text="처리상태" Top="26" Width="62"></Static>
		<Combo BindDataset="ds_search" Border="Flat" CodeColumn="CODE_CD" Column="GBN" DataColumn="CODE_NM" Height="20" Id="cob_Stat" InnerDataset="ds_gbn" Left="903" Style="edit" TabOrder="22" Top="21" Width="87"></Combo>
		<Image Height="11" Id="Image6" ImageID="C_icon" Left="436" TabOrder="27" TabStop="FALSE" Top="26" Width="11"></Image>
		<Static Height="15" Id="Static3" Left="452" Style="tx_left_bold" TabOrder="28" Text="업소코드/명" Top="27" Width="73"></Static>
		<Edit BindDataset="ds_search" Border="Flat" BorderColor="user10" Column="UPSO_CD" Height="20" Id="edt_UPSO_CD" ImeMode="none" Left="528" LeftMargin="4" MaxLength="8" OnChar="edt_UPSO_CD_OnChar" OnKeyDown="edt_UPSO_CD_OnKeyDown" RightMargin="2" Style="edit" TabOrder="25" ToolTipText="업소코드" Top="22" UseIME="FALSE" Width="70"></Edit>
		<Edit Border="Flat" BorderColor="user10" Height="20" Id="edt_UPSO_NM" ImeMode="native,katakana" Left="600" LeftMargin="4" OnKeyDown="edt_UPSO_NM_OnKeyDown" RightMargin="2" Style="edit" TabOrder="26" Top="22" Width="112"></Edit>
		<Button Cursor="HAND" Height="21" Id="btn_FindUpso" ImageID="C_btn_search" Left="716" OnClick="btn_FindUpso_OnClick" TabOrder="29" TabStop="FALSE" Top="23" Width="58"></Button>
		<File Bottom="82" Height="24" Id="File0" Left="984" Right="1008" TabOrder="29" Top="58" Width="24"></File>
		<FileDialog Bottom="80" Height="24" Id="FileDialog0" Left="1008" Right="1032" TabOrder="29" Top="56" Width="24"></FileDialog>
		<Shape BKColor="user7" Bottom="688" Height="3" Id="Shape1" Left="8" LineColor="user7" Right="1036" TabOrder="30" Top="685" Type="Rectangle" Width="1028"></Shape>
		<Grid AreaSelect="true" AutoEnter="TRUE" BindDataset="ds_file" BkColor2="user11" BkSelColor="user9" BoldHead="true" Border="Flat" Bottom="803" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" Face3dColor="user8" FixedColSizing="TRUE" HeadHeight="23" Height="115" Id="grd_file" InputPanel="FALSE" Left="8" LineColor="silver" NoDataText="조회&#32;결과가&#32;없습니다." OnExpandEdit="grd_file_OnExpandEdit" Right="936" RightFixLine="TRUE" RowHeight="20" Style="grid" TabOrder="31" TabStop="true" Top="688" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="928">
			<contents>
				<format id="Default">
					<columns>
						<col width="50"/>
						<col width="203"/>
						<col width="70"/>
						<col width="70"/>
						<col width="527"/>
					</columns>
					<head>
						<cell col="0" color="user12" display="text" text="순번"/>
						<cell col="1" color="user12" colspan="3" display="text" text="파일"/>
						<cell col="4" color="user12" display="text" text="비고(반환사유기입)"/>
					</head>
					<body>
						<cell align="center" col="0" colid="FILE_TYPE" display="text" expr="currow+1"/>
						<cell align="left" col="1" colid="FILE_NM" display="text"/>
						<cell col="2" colid="FILE_UP" display="image" expandchar="expr:decode(CONFIRM_YN,&apos;Y&apos;,&apos;&apos;,&apos;업로드&apos;)" expandimage="C_btn_70" expandshow="expr:decode(CONFIRM_YN,&apos;Y&apos;,&apos;false&apos;,&apos;true&apos;)" expandsize="70"/>
						<cell col="3" colid="FILE_DOWN" display="image" expandchar="expr:decode(FILE_NM,&apos;&apos;,&apos;&apos;,&apos;다운&apos;)" expandimage="C_btn_70" expandshow="expr:decode(FILE_NM,&apos;&apos;,false,true)" expandsize="70"/>
						<cell align="left" col="4" colid="REMAK" display="text" edit="normal"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Shape BKColor="white" Bottom="784" Height="96" Id="Shape6" Left="935" LineColor="user3" Right="1036" TabOrder="32" Top="688" Type="Rectangle" Width="101"></Shape>
		<Button ButtonStyle="TRUE" Height="21" Id="btn_attch_add" ImageID="C_btn_70" Left="951" LeftMargin="26" OnClick="btn_attch_add_OnClick" TabOrder="33" Text="추가" Top="696" TopMargin="1" Width="71"></Button>
		<Button ButtonStyle="TRUE" Height="21" Id="btn_attch_del" ImageID="C_btn_70" Left="951" LeftMargin="26" OnClick="btn_attch_del_OnClick" TabOrder="34" Text="삭제" Top="722" TopMargin="1" Width="71"></Button>
		<Image Height="11" Id="Image0" ImageID="C_icon" Left="18" TabOrder="35" TabStop="FALSE" Top="665" Width="11"></Image>
		<Static Color="user1" Height="11" Id="Static4" Left="34" Style="tx_bold" TabOrder="36" Text="첨부&#32;파일" Top="665" Width="150"></Static>
		<Button ButtonStyle="TRUE" Height="21" Id="btn_confirm" ImageID="C_btn_120" Left="869" LeftMargin="21" OnClick="btn_confirm_OnClick" TabOrder="37" Text="센터장&#32;확인&#32;저장" Top="56" TopMargin="1" Visible="FALSE" Width="120"></Button>
		<Static Color="red" Height="16" Id="Static7" Left="104" TabOrder="38" Text='데이터&#32;&quot;저장&quot;&#32;후에&#32;첨부파일을&#32;비고와&#32;같이&#32;추가해주세요.&#32;업로드&#32;시&#32;자동저장됩니다.&#32;/&#32;센터장&#32;확인&#32;후에는&#32;첨부파일&#32;변경이&#32;불가합니다.' Top="664" Width="900"></Static>
		<MaskEdit Align="Right" Height="20" Id="edt_sum_return" Left="884" Mask="###,###,###,###" Readonly="TRUE" TabOrder="39" Top="654" Value="MaskEdit0" Width="150"></MaskEdit>
		<Button ButtonStyle="TRUE" Height="21" Id="btn_attch_save" ImageID="C_btn_90" Left="943" LeftMargin="26" OnClick="btn_attch_save_OnClick" TabOrder="40" Text="비고저장" Top="746" TopMargin="1" Width="90"></Button>
	</Form>
	<Script><![CDATA[#include "script::common.js"  	// 공통 js
#include "script::global.js"  	// 공통 js
#include "script::commonGibu.js"

function bra04_s22_OnLoadCompleted(obj)
{
	gfn_LoadForm(obj);
	bra04_s22_OnSize();
	
	gfn_PubCode("ds_rept_gbn_ref", 2, "00141", "A"); //입금구분
	
	for(var i=0; i<ds_rept_gbn_ref.rowcount; i++)
	{//입금구분 재정렬
		var code_cd = ds_rept_gbn_ref.GetColumn(i,"CODE_CD");
		var code_nm = ds_rept_gbn_ref.GetColumn(i,"CODE_NM");
		var idx;
		
		if(code_nm == "가상계좌") { idx=0;		}
		else if(code_nm == "자동이체(은행)"){ idx=1;		}
		else if(code_nm == "MICR"){ idx=2;		}
		else if(code_nm == "무통장"){ idx=3;		}
		else if(code_nm == "카드자동"){ idx=4;		}
		else if(code_nm == "기타"){ idx=5;		}
		else{continue; }
		
		ds_rept_gbn.SetColumn(idx,"CODE_CD",code_cd);
		ds_rept_gbn.SetColumn(idx,"CODE_NM",code_nm);
	}

	gfn_GetDataGIBU_CD(cob_BRAN_CD, 0);
	
	cob_BRAN_CD.Value = gds_sessioninfo.GetColumn(0, "BRAN_CD");
	cob_BRAN_CD_OnChanged();
	
	cob_Stat.Index = 0;
	
	gfn_SetPermission(cob_BRAN_CD.value);
	
	cal_ins_start.Value = substr(today(),0,6)+"01";
	cal_ins_end.Value = today();
	
	//은행코드 데이터셋 획득
	ds_code_bank.ClearData();
	gfn_syncCall("SEARCH_BANK_CODE","KOMCA?SYSID=PATHFINDER&MENUID=1000001006005011&EVENTID=search_bank_code","","ds_code_bank=SEL1","","fn_CallBack");
	
	gfn_syncCall("svcAuth","KOMCA?SYSID=PATHFINDER&MENUID=1000001006008008&EVENTID=sel_udtkpres","S=gds_sessioninfo","ds_Auth=SEL1","","fn_CallBack");
	
	if(gds_sessioninfo.GetColumn(0, "DEPT_CD") == "122040100" || gds_sessioninfo.GetColumn(0, "BRAN_CD") == "AL")
	{//센터관리팀 센터명 담당자 수정가능
		cob_Staff_Nm.Enable = true;
		cob_BRAN_CD.Enable = true;
	}
	else if(ds_Auth.rowcount > 0)
	{//센터장 담당자 수정가능
		cob_Staff_Nm.Enable = true;
		cob_BRAN_CD.Enable = false;
	}
	else
	{
		cob_Staff_Nm.Enable = false;
		cob_Staff_Nm.Value = gds_sessioninfo.GetColumn(0, "STAFF_NUM");
		cob_BRAN_CD.Enable = false;
	}
	
	//센터장확인은 센터장 권한
	if(ds_Auth.rowcount > 0 )
	{
		grd_result.SetCellProp("body", grd_result.GetBindCellIndex("body", "CONFIRM1_CHK"), "edit", "expr:decode(CONFIRM2_CHK,'1','none','checkbox')");
		grd_result.SetCellProp("body", grd_result.GetBindCellIndex("body", "REMAK"), "edit", "expr:decode(CONFIRM2_CHK,'1','none','normal')");
		//btn_confirm.Text = "센터장 확인 저장";
		//btn_confirm.Visible = true;
		//ds_temp.SetColumn(0, "GBN", "1");
	}
	
	//담당자확인은 센터관리팀 권한
	if(gds_sessioninfo.GetColumn(0, "BRAN_CD") == "AL" || gds_sessioninfo.GetColumn(0, "DEPT_CD") == "122040100")
	{
		//grd_result.SetCellProp("body", grd_result.GetBindCellIndex("body", "CONFIRM2_CHK"), "edit", "expr:iif(length(RETURN_DAY)&gt;0,'none','checkbox')");
		//grd_result.SetCellProp("body", grd_result.GetBindCellIndex("body", "REMAK"), "edit", "expr:iif(length(RETURN_DAY)&gt;0,'none','normal')"); 
		grd_result.SetCellProp("body", grd_result.GetBindCellIndex("body", "CONFIRM1_CHK"), "edit", "expr:decode(CONFIRM2_CHK,'1','none','checkbox')");
		grd_result.SetCellProp("body", grd_result.GetBindCellIndex("body", "REMAK"), "edit", "expr:decode(CONFIRM2_CHK,'1','none','normal')");
		grd_result.SetCellProp("body", grd_result.GetBindCellIndex("body", "CONFIRM2_CHK"), "edit", "expr:iif(length(RETURN_DAY)==8 || CONFIRM1_CHK==0,'none','checkbox')");
		grd_result.SetCellProp("body", grd_result.GetBindCellIndex("body", "REMAK"), "edit", "expr:iif(length(RETURN_DAY)==8,'none','normal')");
		grd_result.SetCellProp("body", grd_result.GetBindCellIndex("body", "REAL_AMT"), "edit", "expr:iif(length(RETURN_DAY)==8,'none','number')");
		grd_result.SetCellProp("body", grd_result.GetBindCellIndex("body", "RETURN_DAY"), "edit", "date");
		//btn_confirm.Text = "담당자 확인 저장";
		//btn_confirm.Visible = true;
		//ds_temp.SetColumn(0, "GBN", "2");
	}
}

function fn_CommmonButtonClick(strCode)
{
    if(strCode == "NEW"){
		fn_New();
    }
    else if(strCode == "SEARCH"){
		fn_Search();
    }
    else if(strCode == "SAVE"){
		fn_Save();
    }
    else if(strCode == "DELETE"){
		fn_Delete();
    }
    else if(strCode == "EXCEL"){
		fn_Excel();
    }
    else if(strCode == "PRINT"){
		//fn_Print();
    }
    else if(strCode == "CLOSE"){
        close();
    }

	return;
}

function fn_CallBack(srvId,ErrorCode,ErrorMsg)
{
	if(ErrorCode < 0 || length(ErrorMsg) > 0) {
		//에러 공통 팝업
		gfn_SetErrorPop(ErrorCode,ErrorMsg);
		return;
	}
	switch(srvId)
	{
		case "svcSearch" :
			ds_result_OnRowPosChanged();
			break;
		case "svcSave" :
			alert("저장되었습니다.");
			fn_Search();
			break;
		case "svcConfirm" :
			alert("확인처리 되었습니다.");
			fn_Search();
			break;
		case "svcAttch" :
			gfn_syncCall("svcAttchSearch","KOMCA?SYSID=PATHFINDER&MENUID=1000001006001011003&EVENTID=sel_return_attch","S=ds_temp","ds_file=SEL1","","fn_CallBack");
			break;
		default :
			break;
	}
}

function bra04_s22_OnSize(obj,nCx,nCy,nState)
{
	gfn_ObjreSize(Shape0, bra04_s22, 1, 0);
	gfn_ObjreSize(grd_result, bra04_s22, 1, 0);
	gfn_ObjreSize(grd_file, bra04_s22, 0, 1);
}

function fn_New()
{
	/*//센터관리자가 대신 입력해주는 경우도 있지 않을까?
	if(cob_BRAN_CD.Index < 1)
	{ return; }
	else if(cob_Staff_Nm.Index < 1)
	{ return; }*/
	var v_i = ds_result.AddRow();
	ds_result.SetColumn(v_i, "BRAN_CD", cob_BRAN_CD.Value);
	ds_result.SetColumn(v_i, "BRAN_NM", cob_BRAN_CD.Text);
	//ds_result.SetColumn(v_i, "STAFF_CD", gds_sessioninfo.GetColumn(0, "STAFF_NUM"));
	//ds_result.SetColumn(v_i, "STAFF_NM", gds_sessioninfo.GetColumn(0, "HAN_NM"));
	ds_result.SetColumn(v_i, "STAFF_CD", cob_Staff_Nm.Value);
	ds_result.SetColumn(v_i, "STAFF_NM", cob_Staff_Nm.Text);
	ds_result.SetColumn(v_i, "INS_DAY", today());
	
	//gfn_setGridFocus(grd_result, v_i, "UPSO_CD");
}

function fn_Search()
{
	if(!(   (length(cal_ins_start.Value) == 8 && length(cal_ins_end.Value) == 8)
	     || (length(cal_rept_start.Value) == 8 && length(cal_rept_end.Value) == 8)))
	{
		alert("등록일자, 최종확인일자 중\n한가지는 반드시 입력해주세요.");
		return;
	}
	
	gfn_syncCall("svcSearch","KOMCA?SYSID=PATHFINDER&MENUID=1000001006001011003&EVENTID=sel_return_req","S=ds_search","ds_result=SEL1","","fn_CallBack");
	//trace(ds_result.SaveXML());
	var sum_return;
	for (var i=0; i<ds_result.rowcount;i++)
	{
		sum_return= tonumber(sum_return)+ tonumber(ds_result.GetColumn(i,"REAL_AMT"));	
	}
	edt_sum_return.Text=sum_return;

}

function fn_Save()
{
	if (!gfn_CheckFormNull(this)) return;
	if(!Confirm("저장하시겠습니까?")) return;
	
	for(var i=0; i<ds_result.rowcount; i++)
	{
		var UPSO_NM = ds_result.getColumn(i,"UPSO_NM");
		var REPTPRES = ds_result.getColumn(i,"REPTPRES");
		var ACCOUNT_NM = ds_result.getColumn(i,"ACCOUNT_NM");
		
		var REPT_AMT = ds_result.getColumn(i,"REPT_AMT");
		var COMIS = ds_result.getColumn(i,"COMIS");
		var KOMCA_AMT = ds_result.getColumn(i,"KOMCA_AMT");
		var RETURN_AMT = ds_result.getColumn(i,"RETURN_AMT");
		
		if (length(UPSO_NM)==0)
		{
			alert("업소 지정이 안되었습니다.");
			gfn_setGridFocus(grd_result, i, "UPSO_CD");
			return;
		}
		
		if(RETURN_AMT <> (tonumber(REPT_AMT)+tonumber(COMIS)-tonumber(KOMCA_AMT)))
		{	
			alert("반환금액이 잘못 계산되었습니다.");
			gfn_setGridFocus(grd_result, i, "RETURN_AMT");
			return;
		}
		
		if(REPTPRES <>ACCOUNT_NM )
		{
			if(!Confirm(UPSO_NM+"업소, 입금자("+ REPTPRES+")와 예금주("+ACCOUNT_NM +")가 다릅니다. \n 계속 진행하시겠습니까?.")) return;
		}
	}
	
	gfn_syncCall("svcSave","KOMCA?SYSID=PATHFINDER&MENUID=1000001006001011003&EVENTID=mng_return_req","S=ds_result:U","","","fn_CallBack");
}

function fn_Excel()
{
	if(ds_result.rowcount > 0)
	{
		grd_result.ExportExcelEx("입금반환요청내역");
	}
}

function fn_Delete()
{
	if(length(ds_result.GetColumn(ds_result.currow, "RETURN_DAY")) == 8)
	{
		alert("반환이 완료된 내역은 삭제할 수 없습니다.");
	}
	else if(ds_result.GetColumn(ds_result.currow, "CONFIRM2_CHK") == "1" && gds_sessioninfo.GetColumn(0, "BRAN_CD") != "AL")
	{
		alert("반환 담당자가 확인한 내역은 삭제할 수 없습니다.");
	}
	else if(ds_result.GetColumn(ds_result.currow, "CONFIRM1_CHK") == "1" && ds_Auth.rowcount < 1)
	{
		alert("센터장이 확인한 내역은 삭제할 수 없습니다.");
	}
	else
	{
		ds_result.DeleteRow(ds_result.currow);
	}
}

function cal_OnChanged(obj,strOldText,strNewText)
{
	v_head = substr(obj.ID, 0, IndexOf(obj.ID, "_", 7));
	v_tail = substr(obj.ID, IndexOf(obj.ID, "_", 7) + 1);

	if(v_tail == "start")
	{
		if(Object(v_head + "_start").Value > Object(v_head + "_end").Value)
			Object(v_head + "_end").Value = Object(v_head + "_start").Value;
	}
	else if(v_tail == "end")
	{
		if(Object(v_head + "_start").Value > Object(v_head + "_end").Value || Object(v_head + "_start").Value == "")
			Object(v_head + "_start").Value = Object(v_head + "_end").Value;
	}
}


function grd_result_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam)
{
	if(grd_result.GetBindCellIndex("body", "UPSO_CD") == grd_result.GetClickedCell())
	{
		if(nChar == 112)//F1
		{//trace("F1");
			fn_FindUPSO();
		}
		else if(nChar == 13)//Enter
		{//trace("Enter");
			grd_result_OnEnterDown(grd_result, ds_result.currow, grd_result.GetClickedCell(), "", "");
		}
	}
}

function grd_result_OnExpandEdit(obj,nRow,nCell,strVal,nPivotIndex)
{
	if(nCell == grd_result.GetBindCellIndex("body", "UPSO_CD") && ds_result.getRowType(nRow) == "insert")
	{//trace("OnExpand");
		fn_FindUPSO(ds_result.GetColumn(nRow, "UPSO_NM"), nRow);
	}

}

function grd_result_OnEnterDown(obj,nRow,nCell,strVal,nPivotIndex)
{
	if((nCell == grd_result.GetBindCellIndex("body", "UPSO_CD") || nCell == grd_result.GetBindCellIndex("body", "UPSO_NM")) && ds_result.getRowType(nRow) == "insert")
	{//trace("OnEnter");
		//trace("OnEnter : " + ds_result.GetColumn(nRow, "UPSO_CD"));
		fn_GetUPSO_CD(ds_result.GetColumn(nRow, "UPSO_CD"), ds_result.GetColumn(nRow, "UPSO_NM"), nRow);
	}
}

function fn_GetUPSO_CD(pUpsocd, pUpsonm, pRow)
{
	var result = gfn_GetUPSO_CD(cob_BRAN_CD.Value, pUpsocd, pUpsonm);
	var vReturn = false;
	
	if (length(result) > 0)
	{
		vReturn = fn_SetGridUPSO_CD(result, pRow);
	}
	else
	{
		vReturn = fn_FindUPSO(pUpsonm, pRow);
	}
	return vReturn;
}

function fn_SetGridUPSO_CD(result, nRow)
{
	var vArr = result.split(",");
	
	ds_result.FireEvent = false;
	grd_result.FireEvent = false;
	
	ds_result.SetColumn(nRow, "UPSO_CD", vArr[0]);
	ds_result.SetColumn(nRow, "UPSO_NM", vArr[1]);

	ds_result.FireEvent = true;
	grd_result.FireEvent = true;
	
	gfn_setGridFocus(grd_result, nRow, "REPT_GBN");
	
	return true;
}

function fn_FindUPSO(pUpsonm, pRow)
{
	var BRAN_CD = cob_BRAN_CD.Value;
	var UPSO_CD = "";
	var UPSO_NM = pUpsonm;
	
	var inParam =" BRAN_CD=" + quote(BRAN_CD) + " UPSO_CD=" + quote(UPSO_CD) + " UPSO_NM=" + quote(UPSO_NM) + " SGBN=" + quote("bra05_r06");

	var result = Dialog("fi_bra::find_upso.xml", inParam);
	
	if(0 < length(result))
	{
		fn_SetGridUPSO_CD(result, pRow);
	}
}

function grd_result_OnChar(obj,strPreText,nChar,strPostText,nLLParam,nHLParam,nRow,nCell,nPivotIndex)
{
	if(nCell == grd_result.GetBindCellIndex("body", "UPSO_CD") && ds_result.getRowType(nRow) == "insert")
	{
		var strtext = right(strPostText,1);
		var chkstr = "[<!#$%*&_:=|`~'"+Quote("")+";@^+\\>-]";
		
		if(pos(chkstr, strtext) >= 0)   // 특수문자 사용 제한
		{
			return false;
		}
		//trace(strPostText);
		
		var vText = strPostText;
		
		if(length(strPostText) == 8 && nChar >= asc('a') && nChar <= asc('z'))
		{
			//trace("OnChar : " + strPreText + toUpper(chr(nChar)));
			vText = strPreText + toUpper(chr(nChar));
		}
		
		ds_result.SetColumn(nRow, "UPSO_CD", vText);
		grd_result.SetEditSel(length(vText));
	}
}

function cob_BRAN_CD_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	gfn_SetPermission(cob_BRAN_CD.Value);
	
	ds_BRAN_CD.SetColumn(0, "BRAN_CD", cob_BRAN_CD.Value);
	gfn_syncCall("SAWON_CLICK","KOMCA?SYSID=PATHFINDER&MENUID=1000001006007&EVENTID=p_staff_select","S=ds_BRAN_CD","ds_SawonInfo=SEL1","","fn_CallBack");

	var iRow = ds_SawonInfo.InsertRow(0);
	ds_SawonInfo.SetColumn(iRow,"STAFF_CD","");
	ds_SawonInfo.SetColumn(iRow,"STAFF_NM","--ALL--");
	
	cob_Staff_Nm.Value = gds_sessioninfo.GetColumn(0, "STAFF_NUM");
	if(cob_Staff_Nm.Index < 0)
	{
		cob_Staff_Nm.Index = 0;
	}
}

function grd_result_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	g_bran_cd	= ds_result.GetColumn(nRow, "BRAN_CD");
	g_upso_cd	= ds_result.GetColumn(nRow, "UPSO_CD");
    gfn_OpenChildWindow("fi_bra::bra04_r04.xml", "업소 원장 조회","");
}

function edt_UPSO_CD_OnChar(obj,strPreText,nChar,strPostText,LLParam,HLParam)
{
	var strtext = right(strPostText,1);
	var chkstr = "[<!#$%*&_:=|`~'"+Quote("")+";@^+\\>-]"; 
	
	if(pos(chkstr, strtext) >= 0)   // 특수문자 사용 제한
	{
		return false;
	}
	
	if (length(strPostText) == 8 && nChar >= asc('a') && nChar <= asc('z')) {
		obj.Text = strPreText + toUpper(chr(nChar));
		return false;
	}
}

function edt_UPSO_CD_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(this.cob_BRAN_CD.Value==null){
	
        gfn_Confirm("MB_OK", "센터를 선택해주세요.", "경고", "0");
		this.cob_BRAN_CD.SetFocus();
		return false;
	}

	if (nChar == "13") {
		fn_GetUPSO_CD_cd2();
	
	}
	else if (nChar == "112") fn_FindUPSO2();

}

function fn_GetUPSO_CD2()
{

	var BRAN_CD = this.cob_BRAN_CD.Value;
	var UPSO_CD = this.edt_UPSO_CD.Text;
	var UPSO_NM = this.edt_UPSO_NM.Text;

	var result = gfn_GetUPSO_CD(BRAN_CD, UPSO_CD, UPSO_NM);

	if (length(result) > 0) {
		var vArr = result.split(",");
		this.edt_UPSO_CD.Text = vArr[0];
		this.edt_UPSO_NM.Text = vArr[1];
		fn_search();
	}
	else {

		fn_FindUPSO2();

	}
	this.edt_UPSO_NM.Text = this.edt_UPSO_NM_1.Text ;
}
function fn_FindUPSO2()
{
	//업소코드 입력 조회시 바로 조회창 페이지를 거치지 않고 바로 검색
	if(this.cob_BRAN_CD.Value==null){
	
        gfn_Confirm("MB_OK", "센터를 선택해주세요.", "경고", "0");
		this.cob_BRAN_CD.SetFocus();
		return false;
	}

	this.edt_UPSO_NM.SetFocus();
	var BRAN_CD = this.cob_BRAN_CD.Value;
	var UPSO_CD = this.edt_UPSO_CD.Text;
	var UPSO_NM = this.edt_UPSO_NM.Text;
    var inParam = "SGBN=bra05_s01" + " BRAN_CD=" + quote(BRAN_CD) + " UPSO_CD=" + quote(UPSO_CD) + " UPSO_NM=" + quote(UPSO_NM) + " SGBN=" + quote("bra01_s01");
	var result = Dialog("fi_bra::find_upso.xml",inParam);

	if(0 < length(result)){
	    var vArr = result.split(",");
	    this.edt_UPSO_CD.Text = vArr[0];
	    this.edt_UPSO_CD_1.Text = vArr[0];    
	    this.edt_UPSO_NM.Text = vArr[1];
	    this.edt_UPSO_NM_1.Text = vArr[1];    
	    
	}
}

function edt_UPSO_NM_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(cob_BRAN_CD.Text.Length() ==0 ) 
	{
        gfn_Confirm("MB_OK", "센터를 선택해주세요.", "경고", "0");
		cob_BRAN_CD.SetFocus();
		return;
	}
	if (nChar == "112") {
		fn_FindUPSO2();
	}

	return;
}

function btn_FindUpso_OnClick(obj)
{

	if (length(this.cob_BRAN_CD.Value) == 0) {
        gfn_Confirm("MB_OK", "센터를 선택해주세요.", "경고", "0");
		this.cob_BRAN_CD.SetFocus();
		return;
	}
	
	fn_FindUPSO2();
}
/*
function btn_confirm_OnClick(obj)
{
	gfn_syncCall("svcConfirm","KOMCA?SYSID=PATHFINDER&MENUID=1000001006001011003&EVENTID=mng_confirm","S=ds_result:U S1=ds_temp","","","fn_CallBack");
}
*/
function grd_file_OnExpandEdit(obj,nRow,nCell,strVal,nPivotIndex)
{
	if(nCell == grd_file.GetBindCellIndex("body", "FILE_UP") && ds_result.GetColumn(ds_result.currow, "CONFIRM1_CHK") != "1")
	{
		gfn_fileUpSelect(15728640,File0,FileDialog0,"setFileUploadData","","ds_boarddataset");
	}
	else if(nCell == grd_file.GetBindCellIndex("body", "FILE_DOWN"))
	{
		var rout = ds_file.GetColumn(nRow, "SVR_FILE_ROUT");
		var file = ds_file.GetColumn(nRow, "SVR_FILE_NM");
		var org  = ds_file.GetColumn(nRow, "FILE_NM");
		
		gfn_fileDownLoad(rout, file, File0, FileDialog0, org);
	}
}

function setFileUploadData(path,filename,filesize)
{
    gfn_fileUpLoad("dsUploadFile","tr_result","ds_boarddataset");
}

function tr_result(serid,errid,errmsg)
{
	if(trim(serid) == "fileup")
	{
		var filerout 	= dsUploadFile.getcolumn(0,"PATH"); //업로트임시파일위치
		var filenm 	 	= dsUploadFile.getcolumn(0,"UNIFILENAME"); //timestamp파일명
		var upfilename 	= dsUploadFile.getcolumn(0,"UPFILENAME"); //원본파일명
		
		var v_idx = ds_file.currow;
		
		ds_file.SetColumn(v_idx, "SVR_FILE_ROUT", filerout);
		ds_file.SetColumn(v_idx, "FILE_NM", upfilename);
		ds_file.SetColumn(v_idx, "SVR_FILE_NM", filenm);
		//trace(ds_file.SaveXML());
		gfn_syncCall("svcAttch","KOMCA?SYSID=PATHFINDER&MENUID=1000001006001011003&EVENTID=mng_return_attch","S=ds_file:A","","","fn_CallBack");
	} 
}

function btn_attch_add_OnClick(obj)
{
	if(ds_result.GetColumn(ds_result.currow, "CONFIRM1_CHK") == "1")
	{
		alert("센터장이 확인한 내역은 수정할 수 없습니다.");
		return;
	}
	var v_idx = ds_file.AddRow();
	
	ds_file.SetColumn(v_idx, "UPSO_CD", ds_result.GetColumn(ds_result.currow, "UPSO_CD"));
	ds_file.SetColumn(v_idx, "INS_DAY", ds_result.GetColumn(ds_result.currow, "INS_DAY"));
}

function btn_attch_del_OnClick(obj)
{
	if(ds_result.GetColumn(ds_result.currow, "CONFIRM1_CHK") == "1")
	{
		alert("센터장이 확인한 내역은 수정할 수 없습니다.");
		return;
	}
	ds_file.DeleteRow(ds_file.currow);
	
	gfn_syncCall("svcAttch","KOMCA?SYSID=PATHFINDER&MENUID=1000001006001011003&EVENTID=mng_return_attch","S=ds_file:U","","","fn_CallBack");
}

function btn_attch_save_OnClick(obj)
{
	if(ds_result.GetColumn(ds_result.currow, "CONFIRM1_CHK") == "1")
	{
		alert("센터장이 확인한 내역은 수정할 수 없습니다.");
		return;
	}
	trace(ds_file.SaveXML());
	gfn_syncCall("svcAttch","KOMCA?SYSID=PATHFINDER&MENUID=1000001006001011003&EVENTID=mng_return_attch_remak","S=ds_file:U","","","fn_CallBack");
}


function ds_result_OnRowPosChanged(obj,nOldRow,nRow)
{
	ds_temp.SetColumn(0, "UPSO_CD", ds_result.GetColumn(nRow, "UPSO_CD"));
	ds_temp.SetColumn(0, "INS_DAY", ds_result.GetColumn(nRow, "INS_DAY"));
	
	gfn_syncCall("svcAttchSearch","KOMCA?SYSID=PATHFINDER&MENUID=1000001006001011003&EVENTID=sel_return_attch","S=ds_temp","ds_file=SEL1","","fn_CallBack");
	
	if(ds_result.GetRowType(nRow) == "Insert")
	{
		btn_attch_add.Visible = false;
		btn_attch_del.Visible = false;
	}
	else
	{
		btn_attch_add.Visible = true;
		btn_attch_del.Visible = true;
	}
}


function ds_result_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if (strColumnID == "REPT_GBN" )
	{//입금계좌 고정
		var rept_gbn = ds_result.GetColumn(nRow, "REPT_GBN");
		ds_result.SetColumn(nRow,"REPT_BANK_CD","007");
		
		if (rept_gbn=="08")
		{//가상계좌
			ds_result.SetColumn(nRow,"REPT_ACCN_NUM","1010-2323-7511");
		}
		else if(rept_gbn=="01")
		{//자동이체
			ds_result.SetColumn(nRow,"REPT_ACCN_NUM","1010-2323-7506");
		}
		else if(rept_gbn=="02")
		{//MICR
			ds_result.SetColumn(nRow,"REPT_ACCN_NUM","1010-2323-7506");
		}
		else if(rept_gbn=="03")
		{//무통장
			ds_result.SetColumn(nRow,"REPT_ACCN_NUM","1010-2323-7487");
		}
	}
	
	if (strColumnID == "REPT_AMT" || strColumnID == "COMIS" || strColumnID == "KOMCA_AMT" )
	{
		var REPT_AMT = ds_result.getColumn(nRow,"REPT_AMT");
		var COMIS = ds_result.getColumn(nRow,"COMIS");
		var KOMCA_AMT = ds_result.getColumn(nRow,"KOMCA_AMT");
		var RETURN_AMT =tonumber(REPT_AMT)+tonumber(COMIS)-tonumber(KOMCA_AMT);
		ds_result.SetColumn(nRow,"RETURN_AMT",RETURN_AMT);
	}

	
	if (strColumnID == "CONFIRM1_CHK")
	{		
		//센터장확인은 센터장 권한
		if(ds_Auth.rowcount > 0 || gds_sessioninfo.GetColumn(0, "DEPT_CD") == "122040100" || gds_sessioninfo.GetColumn(0, "BRAN_CD") == "AL")
		{
			if(ds_result.GetColumn(nRow,"CONFIRM1_CHK")==0)
			{
				ds_result.SetColumn(nRow,"CONFIRM_ID1","");
				ds_result.SetColumn(nRow,"CONFIRM1_NM","");
				ds_result.SetColumn(nRow,"CONFIRM1_DATE","");
			}			
			else
			{
				ds_result.SetColumn(nRow,"CONFIRM_ID1",gds_sessioninfo.GetColumn(0, "USER_ID"));
				ds_result.SetColumn(nRow,"CONFIRM1_NM",gds_sessioninfo.GetColumn(0, "USER_NM"));
				ds_result.SetColumn(nRow,"CONFIRM1_DATE",today());
			}
		}
		else 
		{
			alert("센터장, 센터관리팀만 변경이 가능합니다.");
			ds_result.SetColumn(nRow,"CONFIRM2_CHK",0);
			return;
		}
		
	}
	if (strColumnID == "CONFIRM2_CHK")
	{
		//담당자확인은 센터관리팀 권한
		if(gds_sessioninfo.GetColumn(0, "BRAN_CD") == "AL" || gds_sessioninfo.GetColumn(0, "DEPT_CD") == "122040100")
		{
			if(ds_result.GetColumn(nRow,"CONFIRM2_CHK")==0)
			{
				ds_result.SetColumn(nRow,"CONFIRM_ID2","");
				ds_result.SetColumn(nRow,"CONFIRM2_NM","");
				ds_result.SetColumn(nRow,"CONFIRM2_DATE","");
			}
			else
			{
				ds_result.SetColumn(nRow,"CONFIRM_ID2",gds_sessioninfo.GetColumn(0, "USER_ID"));
				ds_result.SetColumn(nRow,"CONFIRM2_NM",gds_sessioninfo.GetColumn(0, "USER_NM"));
				ds_result.SetColumn(nRow,"CONFIRM2_DATE",today());
			}
		}
		else 
		{
			alert("센터관리팀만 변경이 가능합니다.");
			ds_result.SetColumn(nRow,"CONFIRM2_CHK",0);
			return;
		}
	}
	//trace(ds_result.SaveXML());
}

]]></Script>
</Window>